<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¿¡ç”¨å¡èˆ‡é¡åº¦ç®¡ç† App</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #3b82f6;
            --bg-color: #f3f4f6;
            --card-bg: #ffffff;
            --text-main: #1f2937;
            --text-sub: #6b7280;
            --danger-color: #ef4444;
            --success-color: #10b981;
            --warning-color: #f59e0b;
        }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        /* è·‘é¦¬ç‡ˆæ¨£å¼ (å·²åŠ é€Ÿ) */
        .marquee-container {
            background-color: var(--text-main);
            color: #fff;
            padding: 8px 0;
            overflow: hidden;
            position: relative;
            font-size: 0.9rem;
            white-space: nowrap;
        }
        .marquee-content {
            display: inline-block;
            white-space: nowrap;
            padding-left: 100%;
            animation: marquee 12s linear infinite; /* 12ç§’è¼ƒå¿« */
        }
        @keyframes marquee {
            0% { transform: translate(0, 0); }
            100% { transform: translate(-100%, 0); }
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            padding-bottom: 100px;
        }

        h1 {
            text-align: center;
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--text-main);
        }

        /* å¡ç‰‡æ¨£å¼ */
        .card-item {
            background-color: var(--card-bg);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border-left: 5px solid var(--primary-color);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .card-name { font-size: 1.2rem; font-weight: 700; }

        .btn-reset {
            background: none;
            border: 1px solid #d1d5db;
            color: var(--text-sub);
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.8rem;
            cursor: pointer;
        }

        .card-details {
            font-size: 0.9rem;
            color: var(--text-sub);
            margin-bottom: 12px;
            line-height: 1.6;
        }

        /* é€šè·¯æ¨™ç±¤ */
        .tag-container {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 6px;
        }
        .channel-tag {
            background-color: #e0f2fe;
            color: #0369a1;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
        }

        /* é€²åº¦æ¢ */
        .progress-wrapper { margin-top: 10px; }
        .progress-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            margin-bottom: 4px;
            color: var(--text-sub);
        }
        .progress-bar-bg {
            background-color: #e5e7eb;
            height: 10px;
            border-radius: 5px;
            overflow: hidden;
        }
        .progress-bar-fill {
            height: 100%;
            background-color: var(--success-color);
            width: 0%;
            transition: width 0.5s ease;
        }
        .progress-bar-fill.warning { background-color: var(--warning-color); }
        .progress-bar-fill.danger { background-color: var(--danger-color); }

        /* è¼¸å…¥å€ */
        .action-row {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        input[type="number"] {
            flex: 1;
            padding: 8px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 1rem;
        }
        .btn-add {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
        }

        /* ç³»çµ±å·¥å…·å€ (å‚™ä»½/é‚„åŸ) */
        .system-tools {
            margin-top: 30px;
            padding: 20px;
            background-color: #fff;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .system-tools h3 {
            margin-top: 0;
            font-size: 1rem;
            color: var(--text-sub);
        }
        .btn-group {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 10px;
        }
        .btn-tool {
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            font-weight: bold;
            cursor: pointer;
            width: 45%;
        }
        .btn-backup { background-color: #4b5563; color: white; }
        .btn-restore { background-color: #6b7280; color: white; border: 1px solid #d1d5db; background: #fff; color: #374151; }

        .footer-info {
            text-align: center;
            font-size: 0.8rem;
            color: #9ca3af;
            margin-top: 20px;
        }
    </style>
</head>
<body>

    <div class="marquee-container">
        <div class="marquee-content">
            ğŸ“¢ ç³»çµ±å…¬å‘Šï¼šè«‹è¨˜å¾—æ¯æœˆ1æ—¥æª¢æŸ¥é¡åº¦æ­¸é›¶ç‹€æ³ï¼ | å°‡å°‡å¡æ–°æ¬Šç›Šå·²æ›´æ–° | è¬¹æ…ç†è²¡ ä¿¡ç”¨è‡³ä¸Š | æ­¡è¿ä½¿ç”¨ App
        </div>
    </div>

    <div class="container">
        <h1>ğŸ’³ é¡åº¦ç›£æ§åŠ©æ‰‹</h1>

        <div id="card-list">
            </div>

        <div class="system-tools">
            <h3>âš™ï¸ ç³»çµ±ç¶­è­·</h3>
            <div class="btn-group">
                <button class="btn-tool btn-backup" onclick="exportData()">â¬‡ï¸ å‚™ä»½è³‡æ–™</button>
                <button class="btn-tool btn-restore" onclick="triggerImport()">â¬†ï¸ é‚„åŸè³‡æ–™</button>
            </div>
            <input type="file" id="import-file" style="display: none;" onchange="importData(this)">
        </div>

        <div class="footer-info">
            Ver 2026.01.07-Fix | Designed by User
        </div>
    </div>

    <script>
        // 1. åˆå§‹åŒ–è³‡æ–™
        const initialCards = [
            {
                id: 'card_001', name: 'å¯Œé‚¦ J å¡', limit: 500000, used: 12500, resetDay: 1,
                note: 'æ—¥éŸ“æ—…éŠ 3%', channels: ['æ—¥æœ¬å¯¦é«”', 'éŸ“åœ‹å¯¦é«”', 'åœ‹å…§ä¸€èˆ¬']
            },
            {
                id: 'card_002', name: 'åœ‹æ³° Cube å¡', limit: 300000, used: 28000, resetDay: 1,
                note: 'å››å¤§æ¬Šç›Šå¤©å¤©åˆ‡æ›', channels: ['ç©æ•¸ä½', 'æ¨‚é¥—è³¼', 'è¶£æ—…è¡Œ']
            },
            {
                id: 'card_003', name: 'æ°¸è± Sport å¡', limit: 7000, used: 3500, resetDay: 1,
                note: 'Apple/Google Pay 7%', channels: ['Apple Pay', 'Google Pay']
            },
            {
                id: 'card_004', name: 'å°‡å°‡å¡ (Next Bank)', limit: 20000, used: 0, resetDay: 1,
                note: 'æŒ‡å®šé€šè·¯å›é¥‹', channels: ['7-11', 'å…¨å®¶', 'Uber Eats', 'foodpanda']
            }
        ];

        // 2. è®€å–æˆ–åˆå§‹åŒ–
        let cards = JSON.parse(localStorage.getItem('myCreditCards')) || initialCards;

        // 3. æ¸²æŸ“ä¸»ç¨‹å¼
        function renderCards() {
            const container = document.getElementById('card-list');
            container.innerHTML = '';

            cards.forEach((card, index) => {
                const percentage = Math.min((card.used / card.limit) * 100, 100).toFixed(1);
                const remaining = card.limit - card.used;
                
                let colorClass = '';
                if (percentage >= 90) colorClass = 'danger';
                else if (percentage >= 70) colorClass = 'warning';

                let tagsHtml = '';
                if(card.channels) {
                    tagsHtml = `<div class="tag-container">` + 
                        card.channels.map(ch => `<span class="channel-tag">${ch}</span>`).join('') + 
                        `</div>`;
                }

                container.innerHTML += `
                    <div class="card-item">
                        <div class="card-header">
                            <div class="card-name">${card.name}</div>
                            <button class="btn-reset" onclick="resetCard(${index})">æ­¸é›¶</button>
                        </div>
                        <div class="card-details">
                            <span>ğŸ“ ${card.note}</span>
                            <span>ğŸ“… çµå¸³æ—¥ï¼š${card.resetDay} è™Ÿ</span>
                            ${tagsHtml}
                        </div>
                        <div class="progress-wrapper">
                            <div class="progress-labels">
                                <span>å·²ç”¨ $${card.used.toLocaleString()}</span>
                                <strong>å‰© $${remaining.toLocaleString()}</strong>
                            </div>
                            <div class="progress-bar-bg">
                                <div class="progress-bar-fill ${colorClass}" style="width: ${percentage}%"></div>
                            </div>
                        </div>
                        <div class="action-row">
                            <input type="number" id="input-${index}" placeholder="é‡‘é¡">
                            <button class="btn-add" onclick="addExpense(${index})">è¨˜å¸³</button>
                        </div>
                    </div>
                `;
            });
        }

        // 4. æ ¸å¿ƒé‚è¼¯
        function addExpense(index) {
            const val = parseInt(document.getElementById(`input-${index}`).value);
            if (val > 0) {
                cards[index].used += val;
                saveAndRender();
            }
        }

        function resetCard(index) {
            if(confirm('ç¢ºèªæ­¸é›¶ï¼Ÿ')) {
                cards[index].used = 0;
                saveAndRender();
            }
        }

        function saveAndRender() {
            localStorage.setItem('myCreditCards', JSON.stringify(cards));
            renderCards();
        }

        // 5. å‚™ä»½èˆ‡é‚„åŸåŠŸèƒ½ (ä¿®å¾©é‡é»)
        function exportData() {
            const dataStr = JSON.stringify(cards, null, 2);
            const blob = new Blob([dataStr], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `credit_card_backup_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            alert('âœ… å‚™ä»½æª”æ¡ˆå·²ä¸‹è¼‰ï¼');
        }

        function triggerImport() {
            document.getElementById('import-file').click();
        }

        function importData(input) {
            const file = input.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    if (Array.isArray(importedData)) {
                        cards = importedData;
                        saveAndRender();
                        alert('âœ… è³‡æ–™é‚„åŸæˆåŠŸï¼');
                    } else {
                        alert('âŒ æª”æ¡ˆæ ¼å¼éŒ¯èª¤');
                    }
                } catch (err) {
                    alert('âŒ ç„¡æ³•è®€å–æª”æ¡ˆ');
                }
            };
            reader.readAsText(file);
        }

        // å•Ÿå‹•
        renderCards();

    </script>
</body>
</html>
