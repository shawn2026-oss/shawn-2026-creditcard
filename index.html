<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-FMD1PV6QZV"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-FMD1PV6QZV');
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="åˆ·å¡å›é¥‹ç®¡å®¶">
    <meta name="theme-color" content="#F0F2F5">
    <title>åˆ·å¡å›é¥‹ç®¡å®¶</title>
    
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" sizes="192x192" href="icon-192.png">
    <link rel="icon" type="image/png" sizes="48x48" href="icon-48.png">
    <link rel="shortcut icon" href="icon-48.png">

    <style>
        :root { --bg-color: #F0F2F5; --text-primary: #1C1C1E; --text-secondary: #8E8E93; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif; 
            background-color: #E0E5EC; color: var(--text-primary); margin: 0; 
            display: flex; justify-content: center; min-height: 100vh; 
            -webkit-font-smoothing: antialiased; 
            overscroll-behavior-y: none;
        }
        
        .app-container { 
            width: 100%; max-width: 480px; background-color: var(--bg-color); 
            min-height: 100vh; padding: 16px 12px; 
            padding-top: env(safe-area-inset-top, 20px); 
            padding-bottom: env(safe-area-inset-bottom, 20px); 
            box-shadow: 0 0 40px rgba(0,0,0,0.05); display: flex; flex-direction: column; box-sizing: border-box; 
        }
        @media (max-width: 480px) { body { background-color: var(--bg-color); } .app-container { box-shadow: none; width: 100%; max-width: 100%; } }
        
        /* --- ä¿®æ”¹é» 1ï¼šç‰ˆæœ¬è™Ÿç½®é ‚æ¨£å¼ --- */
        .top-version-bar {
            text-align: center;
            font-size: 11px;
            color: #999;
            background-color: #e6e8eb;
            padding: 4px;
            border-radius: 4px;
            margin-bottom: 12px;
            font-family: monospace;
        }

        .author-top { font-size: 12px; font-weight: 800; color: #007AFF; margin-bottom: 4px; letter-spacing: 0.5px; }
        .header-section { margin-bottom: 12px; display: flex; justify-content: space-between; align-items: flex-end; }
        h1 { font-size: 22px; font-weight: 800; margin: 0; color: #333; letter-spacing: -0.5px; line-height: 1.2;}
        .subtitle { font-size: 11px; color: var(--text-secondary); font-weight: 500; }
        .today-date { background: rgba(0,0,0,0.05); padding: 2px 6px; border-radius: 4px; font-size: 11px; font-weight: 600; color: #555; margin-left: 5px;}
        
        /* --- ä¿®æ”¹é» 2ï¼šè·‘é¦¬ç‡ˆæ¨£å¼åŠ å¼· --- */
        .news-ticker {
            background: #FFF9C4; color: #856404; 
            border-radius: 8px; margin-bottom: 12px; 
            padding: 8px 10px; font-size: 12px; font-weight: 600;
            overflow: hidden; white-space: nowrap; position: relative;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            display: flex; align-items: center;
            min-height: 32px;
        }
        .ticker-content {
            display: inline-block;
            padding-left: 100%; /* å¾æœ€å³å´é–‹å§‹ */
            /* æ™‚é–“æ”¹ç‚º 30sï¼Œç¢ºä¿é•·æ–‡å­—èƒ½æ…¢æ…¢è·‘å®Œ */
            animation: scroll-left 30s linear infinite; 
        }
        @keyframes scroll-left {
            0% { transform: translateX(0); }
            100% { transform: translateX(-100%); } /* ç¢ºä¿å®Œå…¨ç§»å‡ºç•«é¢ */
        }

        .total-reward-card { background: #2c3e50; color: white; border-radius: 16px; padding: 14px 20px; margin-bottom: 16px; display: flex; justify-content: space-between; align-items: center; position: relative; overflow: hidden; box-shadow: 0 4px 10px rgba(44, 62, 80, 0.2); }
        .total-reward-card::after { content: ''; position: absolute; top: -50%; right: -50%; width: 150px; height: 150px; background: rgba(255,255,255,0.1); border-radius: 50%; pointer-events: none; }
        .total-reward-label { font-size: 13px; font-weight: 600; opacity: 0.9; }
        .total-reward-amount { font-size: 28px; font-weight: 700; letter-spacing: -0.5px; }

        #urgent-alert-area { display: none; margin-bottom: 12px; }
        .urgent-card { background: linear-gradient(135deg, #FF3B30, #FF2D55); color: white; border-radius: 12px; padding: 10px 14px; box-shadow: 0 4px 10px rgba(255, 59, 48, 0.25); animation: pulse 2s infinite; }
        .urgent-title { font-size: 13px; font-weight: 800; display: flex; align-items: center; gap: 6px; }
        .urgent-item { background: rgba(255,255,255,0.25); border-radius: 8px; padding: 6px 10px; margin-top: 6px; font-size: 12px; font-weight: 600; line-height: 1.3; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.01); } 100% { transform: scale(1); } }

        #card-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 20px; }

        .card-tile { border-radius: 16px; padding: 12px; min-height: 135px; display: flex; flex-direction: column; justify-content: space-between; box-shadow: 0 4px 12px rgba(0,0,0,0.1); position: relative; transition: transform 0.1s; cursor: pointer; color: white; overflow: hidden; }
        .card-tile:active { transform: scale(0.97); }
        .tile-header { display: flex; justify-content: space-between; align-items: flex-start; z-index: 2; margin-bottom: 2px;}
        .tile-name { font-size: 14px; font-weight: 700; line-height: 1.2; text-shadow: 0 1px 2px rgba(0,0,0,0.15); }
        .tile-note { font-size: 10px; font-weight: 500; opacity: 0.9; margin-bottom: 4px; display: block; line-height: 1.2; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; z-index: 2; letter-spacing: -0.2px; }
        .tile-rule { font-size: 10px; font-weight: 700; background: rgba(0,0,0,0.25); padding: 2px 6px; border-radius: 4px; display: inline-block; margin-bottom: 6px; color: #FFD700; z-index: 2; }
        .rate-badge { background: rgba(255,255,255,0.3); font-size: 10px; font-weight: 800; padding: 2px 5px; border-radius: 5px; white-space: nowrap; backdrop-filter: blur(4px); margin-left: 2px; flex-shrink: 0; }
        .tile-body { z-index: 2; flex:1; display:flex; flex-direction:column; justify-content:center; }
        .tile-stat { font-size: 20px; font-weight: 700; letter-spacing: -0.5px; margin-bottom: 2px;}
        .tile-earned { font-size: 11px; font-weight: 600; color: rgba(255,255,255,0.95); display: flex; align-items: center; gap: 3px;}
        .tile-earned::before { content: 'è³º'; font-size: 9px; opacity: 0.8; border: 1px solid rgba(255,255,255,0.7); padding: 0 2px; border-radius: 3px;}
        .tile-footer { z-index: 2; margin-top: 6px; position: relative; }
        .progress-track { background: rgba(0,0,0,0.2); height: 4px; border-radius: 2px; overflow: hidden; margin-bottom: 4px; }
        .progress-fill { height: 100%; background: rgba(255,255,255,0.95); transition: width 0.5s ease; }
        .tile-msg { font-size: 11px; font-weight: 700; opacity: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; line-height: 1.2; }

        .history-section { flex: 1; display: flex; flex-direction: column; }
        .history-title { font-size: 14px; font-weight: 700; margin-bottom: 8px; color: #555; }
        .card-group-details { background: white; border-radius: 12px; margin-bottom: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); overflow: hidden; }
        .card-group-details[open] { box-shadow: 0 4px 10px rgba(0,0,0,0.08); }
        .card-group-summary { padding: 12px 16px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; font-weight: 700; font-size: 13px; color: #333; outline: none; list-style: none; background: #fff; transition: background 0.2s; }
        .card-group-summary::-webkit-details-marker { display: none; }
        .card-group-summary:active { background: #f9f9f9; }
        .group-name { display: flex; align-items: center; gap: 6px; }
        .group-total { color: #007AFF; font-family: -apple-system, monospace; font-size: 14px;}
        .history-item { padding: 10px 16px; border-top: 1px solid #f0f0f0; display: flex; justify-content: space-between; align-items: center; font-size: 12px; background: #fafafa; }
        .h-name { font-weight: 600; color: #555; }
        .h-date { font-size: 10px; color: #aaa; margin-top: 2px;}
        .h-amount { font-weight: 700; color: #333; font-size: 13px; }
        .btn-delete-single { background: none; border: none; color: #ccc; font-size: 14px; padding: 0 5px; cursor: pointer; margin-left: 8px;}
        .btn-delete-single:hover { color: #FF3B30; }

        .settings-area { margin-top: auto; display: flex; gap: 8px; flex-direction: column; padding-top: 20px;}
        .settings-row { display: flex; gap: 8px; }
        .btn-tool { flex: 1; padding: 10px; border-radius: 10px; font-size: 12px; font-weight: 600; border: 1px solid #eee; background: white; color: #555; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 4px; box-shadow: 0 1px 3px rgba(0,0,0,0.05);}
        .btn-donate { background: linear-gradient(135deg, #E30000, #FF5050); color: #fff; border: none; box-shadow: 0 4px 10px rgba(227, 0, 0, 0.3); font-size: 14px; }
        .btn-reset-visible { width: 100%; padding: 12px; background-color: #fff5f5; border: 1px solid #ffdede; color: #FF3B30; border-radius: 12px; font-weight: 600; font-size: 12px; cursor: pointer; margin-top: 10px;}
        
        /* ç§»é™¤åŸæœ¬åº•éƒ¨çš„ footer æ¨£å¼ï¼Œæ”¹ç”¨ä¸Šé¢çš„ top-version-bar */
        .footer { display: none; } 

        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); backdrop-filter: blur(3px); z-index: 1000; align-items: center; justify-content: center; }
        .modal-content { 
            background: white; width: 85%; max-width: 320px; border-radius: 20px; padding: 20px; 
            box-shadow: 0 25px 50px rgba(0,0,0,0.25); animation: modalPop 0.2s; 
            display: flex; flex-direction: column;
            max-height: 90vh;
        }
        
        .input-group label { display: block; font-size: 12px; font-weight: 600; color: #888; margin-bottom: 6px; margin-top: 10px; }
        input { width: 100%; padding: 10px; border: 2px solid #f0f0f0; background: #fff; border-radius: 12px; font-size: 18px; box-sizing: border-box; outline: none; font-weight: 600; color: #333; }
        .btn-group { display: flex; gap: 8px; margin-top: 20px; flex-shrink: 0; }
        .btn { flex: 1; padding: 10px; border: none; border-radius: 12px; font-size: 15px; font-weight: 600; cursor: pointer; }
        .btn-cancel { background: #f5f5f5; color: #333; }
        .btn-confirm { background: #007AFF; color: white; }
    </style>
</head>
<body>
    <div class="app-container">
        
        <div id="footer-version" class="top-version-bar">Loading...</div>

        <div class="header-section">
            <div>
                <div class="author-top">Designed by Shawn</div>
                <h1>åˆ·å¡å›é¥‹ç®¡å®¶</h1>
            </div>
            <div class="subtitle"><span class="today-date" id="dateDisplay"></span></div>
        </div>

        <div class="news-ticker">
            <div class="ticker-content" id="news-text">Loading...</div>
        </div>

        <div id="urgent-alert-area"><div class="urgent-card"><div class="urgent-title">ğŸš¨ ä»»å‹™åˆ°æœŸè­¦å ±</div><div id="urgent-list"></div></div></div>
        
        <div class="total-reward-card">
            <span class="total-reward-label">æœ¬æœˆé ä¼°</span>
            <span class="total-reward-amount" id="totalRewardDisplay">$0</span>
        </div>
        
        <div id="card-grid"></div>

        <div class="history-section">
            <div class="history-title">æ¶ˆè²»æ˜ç´° (é»æ“Šå¡åˆ¥å±•é–‹)</div>
            <div id="history-container"></div>
        </div>
        
        <div class="settings-area">
            <div class="settings-row">
                <button class="btn-tool" onclick="exportData()">ğŸ’¾ å‚™ä»½æª”æ¡ˆ</button>
                <button class="btn-tool" onclick="triggerImport()">ğŸ“¥ è®€æª”é‚„åŸ</button>
                <input type="file" id="fileInput" style="display:none" accept=".json, .txt" onchange="importFile(this)">
            </div>
            <button class="btn-tool btn-donate" onclick="showDonateModal()">â˜• è´ŠåŠ©é–‹ç™¼è€… (æ”¯æŒæ›´æ–°)</button>
            <button class="btn-reset-visible" onclick="resetAllData()">ğŸ—‘ï¸ é‡ç½®æ‰€æœ‰è³‡æ–™</button>
        </div>
        
        </div>

    <div id="transactionModal" class="modal">
        <div class="modal-content">
            <h2 id="modalTitle" style="margin: 0 0 4px 0; font-size: 18px; font-weight: 800; color:#333;"></h2>
            <div style="font-size:12px; color:#888; margin-bottom:10px; font-weight: 500;" id="modalSubtitle"></div>
            <div id="modalParkingInfo" style="background:#FFF9C4; color:#856404; padding:10px; border-radius:10px; font-size:12px; margin-bottom:12px; border-left:4px solid #FFC107; display:none; line-height:1.5;"></div>
            <input type="hidden" id="cardIdInput"> 
            <div class="input-group" style="margin-top:0;"><input type="number" id="amountInput" placeholder="$ é‡‘é¡" inputmode="numeric" style="font-size:28px; text-align:center; border:none; border-bottom:2px solid #eee; border-radius:0;"></div>
            <div class="input-group
