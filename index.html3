<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-FMD1PV6QZV"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-FMD1PV6QZV');
    </script>

    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="åˆ·å¡å›é¥‹ç®¡å®¶">
    <meta name="theme-color" content="#F0F2F5">
    
    <meta property="og:title" content="åˆ·å¡å›é¥‹ç®¡å®¶ - æ‚¨çš„ä¿¡ç”¨å¡æœ€ä½³å¹«æ‰‹">
    <meta property="og:description" content="è‡ªå‹•è¨ˆç®—å›é¥‹ã€å³æ™‚é¡¯ç¤ºä¸Šé™ã€æ”¯æ´æˆ°ç¸¾åœ–åˆ†äº«ã€‚å¿«ä¾†çœ‹çœ‹ä½ æœ¬æœˆè³ºäº†å¤šå°‘å›é¥‹ï¼">
    <meta property="og:image" content="https://shawn2026-oss.github.io/shawn-2026-creditcard/icon-192.png">
    <meta property="og:url" content="https://shawn2026-oss.github.io/shawn-2026-creditcard/">
    <meta property="og:type" content="website">

    <title>åˆ·å¡å›é¥‹ç®¡å®¶</title>
 
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" sizes="192x192" href="icon-192.png">
    <link rel="icon" type="image/png" sizes="48x48" href="icon-48.png">
    <link rel="shortcut icon" href="icon-48.png">

    <style>
        /* é—œéµä¿®æ­£ï¼šè§£æ±ºé é¢éå¯¬å•é¡Œ */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        :root { --bg-color: #F0F2F5; --text-primary: #1C1C1E; --text-secondary: #8E8E93; }
        body { font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif; background-color: #E0E5EC; color: var(--text-primary); margin: 0; display: flex; justify-content: center; min-height: 100vh; -webkit-font-smoothing: antialiased; }
        .app-container { width: 100%; max-width: 480px; background-color: var(--bg-color); min-height: 100vh; padding: 16px 12px; padding-top: env(safe-area-inset-top, 20px); padding-bottom: env(safe-area-inset-bottom, 20px); box-shadow: 0 0 40px rgba(0,0,0,0.05); display: flex; flex-direction: column; }
        @media (max-width: 480px) { body { background-color: var(--bg-color); } .app-container { box-shadow: none; width: 100%; max-width: 100%; } }
        .header-top-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2px; width: 100%; }
        .author-top { font-size: 12px; font-weight: 800; color: #007AFF; letter-spacing: 0.5px; }
        .version-tag { font-size: 10px; color: #888; font-weight: 600; background: rgba(0,0,0,0.05); padding: 2px 8px; border-radius: 4px; white-space: nowrap; flex-shrink: 0; display: inline-block; min-width: 36px; text-align: center; }
        .header-section { margin-bottom: 12px; display: flex; justify-content: space-between; align-items: flex-end; }
        h1 { font-size: 22px; font-weight: 800; margin: 0; color: #333; letter-spacing: -0.5px; line-height: 1.2;}
        .subtitle { font-size: 11px; color: var(--text-secondary); font-weight: 500; }
        .today-date { background: rgba(0,0,0,0.05); padding: 2px 6px; border-radius: 4px; font-size: 11px; font-weight: 600; color: #555; margin-left: 5px;}
        .news-ticker { background: #FFF9C4; color: #856404; border-radius: 8px; margin-bottom: 12px; height: 36px; display: block; overflow: hidden; white-space: nowrap; position: relative; box-shadow: 0 2px 5px rgba(0,0,0,0.05); width: 100%; transform: translate3d(0,0,0); }
        .ticker-content { display: inline-block; height: 36px; line-height: 36px; padding-left: 100%; min-width: 100%; box-sizing: content-box; animation: scroll-left 15s linear infinite; will-change: transform; transform: translate3d(0, 0, 0); }
        @keyframes scroll-left { 0% { transform: translate3d(0, 0, 0); } 100% { transform: translate3d(-100%, 0, 0); } }
        .total-reward-card { background: #2c3e50; color: white; border-radius: 16px; padding: 16px 20px; margin-bottom: 16px; display: flex; justify-content: space-between; align-items: center; position: relative; overflow: hidden; box-shadow: 0 4px 10px rgba(44, 62, 80, 0.2); }
        .total-reward-card::after { content: ''; position: absolute; top: -50%; right: -50%; width: 150px; height: 150px; background: rgba(255,255,255,0.1); border-radius: 50%; pointer-events: none; }
        .total-info { display: flex; flex-direction: column; gap: 2px; }
        .total-reward-label { font-size: 13px; font-weight: 600; opacity: 0.9; }
        .total-reward-amount { font-size: 32px; font-weight: 800; letter-spacing: -0.5px; }
        .btn-share-result { background: rgba(255,255,255,0.2); backdrop-filter: blur(5px); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 8px 16px; border-radius: 20px; font-size: 13px; font-weight: 700; cursor: pointer; display: flex; align-items: center; gap: 6px; transition: all 0.2s; z-index: 2; }
        .btn-share-result:active { transform: scale(0.95); background: rgba(255,255,255,0.3); }
        #urgent-alert-area { display: none; margin-bottom: 12px; }
        .urgent-card { background: linear-gradient(135deg, #FF3B30, #FF2D55); color: white; border-radius: 12px; padding: 10px 14px; box-shadow: 0 4px 10px rgba(255, 59, 48, 0.25); animation: pulse 2s infinite; }
        .urgent-title { font-size: 13px; font-weight: 800; display: flex; align-items: center; gap: 6px; }
        .urgent-item { background: rgba(255,255,255,0.25); border-radius: 8px; padding: 6px 10px; margin-top: 6px; font-size: 12px; font-weight: 600; line-height: 1.3; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.01); } 100% { transform: scale(1); } }
        #card-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 20px; flex: 1; align-content: start;}
        .card-tile { border-radius: 16px; padding: 12px; min-height: 135px; display: flex; flex-direction: column; justify-content: space-between; box-shadow: 0 4px 12px rgba(0,0,0,0.1); position: relative; transition: transform 0.1s; cursor: pointer; color: white; overflow: hidden; user-select: none; -webkit-user-select: none; touch-action: pan-y; }
        .card-tile:active { transform: scale(0.97); }
        .sortable-ghost { opacity: 0.4; transform: scale(0.95); }
        .sortable-drag { cursor: grabbing; }
        .tile-header { display: flex; justify-content: space-between; align-items: flex-start; z-index: 2; margin-bottom: 2px;}
        .tile-name { font-size: 15px; font-weight: 800; line-height: 1.2; text-shadow: 0 1px 2px rgba(0,0,0,0.15); }
        .tile-nickname-badge { display: inline-block; font-size: 10px; font-weight: 800; background: rgba(0,0,0,0.2); color: #FFD700; padding: 2px 6px; border-radius: 4px; margin-bottom: 4px; z-index: 2; width: fit-content; }
        .tile-nickname-badge.placeholder { background: rgba(0,0,0,0.1); color: #aaa; }
        .tile-note { font-size: 10px; font-weight: 500; opacity: 0.9; margin-bottom: 4px; display: block; line-height: 1.2; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; z-index: 2; letter-spacing: -0.2px; }
        .tile-rule { font-size: 10px; font-weight: 700; background: rgba(0,0,0,0.25); padding: 2px 6px; border-radius: 4px; display: inline-block; margin-bottom: 6px; color: #FFD700; z-index: 2; }
        .rate-badge { background: rgba(255,255,255,0.3); font-size: 10px; font-weight: 800; padding: 2px 5px; border-radius: 5px; white-space: nowrap; backdrop-filter: blur(4px); margin-left: 2px; flex-shrink: 0; }
        .tile-body { z-index: 2; flex:1; display:flex; flex-direction:column; justify-content:center; }
        .tile-stat { font-size: 20px; font-weight: 700; letter-spacing: -0.5px; margin-bottom: 2px;}
        .tile-earned { font-size: 11px; font-weight: 600; color: rgba(255,255,255,0.95); display: flex; align-items: center; gap: 3px;}
        .tile-earned::before { content: 'è³º'; font-size: 9px; opacity: 0.8; border: 1px solid rgba(255,255,255,0.7); padding: 0 2px; border-radius: 3px;}
        .tile-footer { z-index: 2; margin-top: 6px; position: relative; }
        .progress-track { background: rgba(0,0,0,0.2); height: 4px; border-radius: 2px; overflow: hidden; margin-bottom: 4px; }
        .progress-fill { height: 100%; background: rgba(255,255,255,0.95); transition: width 0.5s ease; }
        .tile-msg { font-size: 11px; font-weight: 700; opacity: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; line-height: 1.2; }
        .tile-cycle-hint { font-size: 9px; color: rgba(255,255,255,0.6); margin-top: 2px; text-align: right; }
        .tile-cycle-hint.dark-text { color: rgba(0,0,0,0.4); }
        .history-section { flex: 1; display: flex; flex-direction: column; }
        .history-title { font-size: 14px; font-weight: 700; margin-bottom: 8px; color: #555; }
        .settings-area { margin-top: auto; display: flex; gap: 8px; flex-direction: column; padding-top: 20px;}
        .settings-row { display: flex; gap: 8px; }
        .btn-tool { flex: 1; padding: 10px; border-radius: 10px; font-size: 12px; font-weight: 600; border: 1px solid #eee; background: white; color: #555; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 4px; box-shadow: 0 1px 3px rgba(0,0,0,0.05);}
        .btn-manage { background: #333; color: white; border: none; box-shadow: 0 2px 8px rgba(0,0,0,0.2); }
        .btn-reset-visible { width: 100%; padding: 12px; background-color: #fff5f5; border: 1px solid #ffdede; color: #FF3B30; border-radius: 12px; font-weight: 600; font-size: 12px; cursor: pointer; margin-top: 10px;}
        .btn-ig { width: 100%; padding: 12px; background: linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%); color: white; border: none; border-radius: 12px; font-weight: 600; font-size: 14px; cursor: pointer; margin-top: 10px; box-shadow: 0 4px 12px rgba(220, 39, 67, 0.3); display: flex; align-items: center; justify-content: center; gap: 6px; }
        .btn-ig:active { transform: scale(0.98); }
        .details-content { display: none; background: #fff; border: 1px solid #eee; border-radius: 8px; padding: 10px; margin-top: 6px; font-size: 11px; color: #666; line-height: 1.6; }
        .modal { display: none; position: fixed !important; top: 0 !important; left: 0 !important; width: 100%; height: 100%; background: rgba(0,0,0,0.5); backdrop-filter: blur(3px); z-index: 10000; align-items: center; justify-content: center; }
        .modal-content { background: white; width: 85%; max-width: 320px; border-radius: 20px; padding: 20px; box-shadow: 0 25px 50px rgba(0,0,0,0.25); animation: modalPop 0.2s; display: flex; flex-direction: column; max-height: 85vh; overflow-y: auto; position: relative; z-index: 10001; }
        .modal-body-input { flex-shrink: 0; }
        .welcome-overlay { position: fixed !important; top: 0 !important; left: 0 !important; width: 100vw; height: 100vh; background: rgba(0,0,0,0.85); z-index: 20000; display: none; justify-content: center; align-items: center; backdrop-filter: blur(5px); }
        .welcome-content { background: white; width: 85%; max-width: 340px; border-radius: 24px; padding: 24px; text-align: center; box-shadow: 0 10px 40px rgba(0,0,0,0.5); animation: modalPop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .welcome-title { font-size: 22px; font-weight: 800; color: #333; margin-bottom: 10px; }
        .welcome-desc { font-size: 14px; color: #666; margin-bottom: 20px; line-height: 1.5; }
        .welcome-list { text-align: left; max-height: 300px; overflow-y: auto; margin-bottom: 20px; border: 1px solid #eee; border-radius: 12px; padding: 10px; }
        .welcome-item { display: flex; align-items: center; padding: 10px; border-bottom: 1px solid #f9f9f9; }
        .welcome-item:last-child { border-bottom: none; }
        .welcome-item input { width: 20px; height: 20px; margin-right: 12px; margin-bottom: 0; padding: 0;}
        .welcome-item label { margin: 0; font-size: 15px; font-weight: 600; color: #333; flex: 1; }
        .welcome-btn { background: #007AFF; color: white; border: none; padding: 14px; width: 100%; border-radius: 12px; font-size: 16px; font-weight: 700; cursor: pointer; box-shadow: 0 4px 12px rgba(0,122,255,0.3); }
        .welcome-btn:active { transform: scale(0.98); }
        #captureArea { position: fixed; top: -9999px; left: -9999px; z-index: -1; }
        .share-card-node { width: 320px; height: auto; background: linear-gradient(135deg, #1C1C1E, #2c3e50); color: white; border-radius: 20px; padding: 24px; box-sizing: border-box; font-family: -apple-system, sans-serif; text-align: center; box-shadow: 0 20px 40px rgba(0,0,0,0.3); margin-bottom: 20px; }
        .share-header { font-size: 14px; opacity: 0.8; letter-spacing: 1px; margin-bottom: 4px; text-transform: uppercase; }
        .share-month { font-size: 18px; font-weight: 700; margin-bottom: 20px; }
        .share-amount { font-size: 48px; font-weight: 800; margin-bottom: 20px; text-shadow: 0 2px 10px rgba(0,0,0,0.2); }
        .share-divider { height: 1px; background: rgba(255,255,255,0.1); margin: 15px 0; }
        .share-footer { font-size: 11px; opacity: 0.8; margin-top: 15px; background: rgba(255,255,255,0.1); padding: 8px; border-radius: 8px; font-weight: 600; }
        .share-list { text-align: left; margin-top: 10px; }
        .share-item { display: flex; justify-content: space-between; font-size: 13px; margin-bottom: 8px; font-weight: 500; }
        .share-item span:last-child { font-weight: 700; color: #FFD700; }
        .social-btn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; width: 100%; margin-top: 10px; }
        .social-btn { display: flex; align-items: center; justify-content: center; gap: 6px; padding: 12px; border-radius: 12px; border: none; font-size: 13px; font-weight: 700; color: white; cursor: pointer; transition: transform 0.1s; }
        .social-btn:active { transform: scale(0.97); }
        .social-btn.instagram { background: linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%); }
        .social-btn.threads { background: #000000; border: 1px solid #333; }
        .social-btn.facebook { background: #1877F2; }
        .social-btn.line { background: #06C755; }
        .social-btn.download { background: #555; grid-column: span 2; }
        
        /* ä¿®æ­£ï¼šUni Open å“ç‰ŒæŒ‰éˆ•æ¨£å¼ */
        .brand-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px; margin-top: 6px; }
        .brand-btn { 
            border: 1px solid #ddd; background: white; border-radius: 6px; padding: 8px 4px; 
            font-size: 11px; color: #666; text-align: center; cursor: pointer; 
            transition: 0.2s; font-weight: 600; display: flex; align-items: center; justify-content: center;
            min-height: 32px; /* ç¢ºä¿æœ‰é«˜åº¦ */
        }
        .brand-btn.active { background: #FF9800; color: white; border-color: #F57C00; box-shadow: 0 2px 4px rgba(255, 152, 0, 0.3); }
        
        /* å…¶ä»–é¸é …æ¨£å¼ä¿æŒ */
        #pigRichOptions, #greenCardOptions, #uniOptions, #happyOptions, #hsbcOptions, #uniOpenOptions, #richartOptions, #fubonJOptions, #jiheOptions, #kumamonOptions, #sinopacCurrencyOptions, #sinopacMitsuiOptions, #jiangOptions { display: none; background: #f9f9f9; padding: 10px; border-radius: 10px; margin-top: 10px; border: 1px dashed #ddd; }
        .option-row { display: flex; align-items: center; justify-content: space-between; margin-bottom: 6px; font-size: 13px; font-weight: 600; color: #555; }
        .option-row input[type="checkbox"], .option-row input[type="radio"], .option-row input[type="number"] { margin: 0; }
        .option-row input[type="checkbox"], .option-row input[type="radio"] { width: 20px; height: 20px; }
        .option-row.read-only { opacity: 0.8; pointer-events: none; }
        .option-row.read-only input { opacity: 0.6; }
        .option-row.expired { opacity: 0.5; pointer-events: none; background: #eee; padding: 4px; border-radius: 4px; }
        .manage-item { display: flex; align-items: center; justify-content: space-between; padding: 16px 12px; border-bottom: 1px solid #f0f0f0; background: #fff; cursor: pointer; transition: background 0.2s; }
        .manage-item:active { background: #f9f9f9; }
        .manage-info { display: flex; flex-direction: column; gap: 4px; }
        .manage-name { font-size: 15px; font-weight: 700; color: #333; }
        .manage-desc { font-size: 12px; color: #999; }
        .switch { position: relative; display: inline-block; width: 44px; height: 24px; flex-shrink: 0; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 2px; bottom: 2px; background-color: white; transition: .4s; border-radius: 50%; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        input:checked + .slider { background-color: #34C759; }
        input:checked + .slider:before { transform: translateX(20px); }
        .btn-card-setting { background: #f0f0f0; border: none; border-radius: 50%; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; font-size: 16px; cursor: pointer; margin-right: 12px; color: #555; }
        .btn-card-setting:hover { background: #e0e0e0; }
        .happy-dashboard { background: transparent; border: none; padding: 0; margin-top: 10px; display: none; }
        .dash-row { margin-bottom: 8px; }
        .dash-label { font-size: 12px; font-weight: 700; color: #555; display: flex; justify-content: space-between; margin-bottom: 2px;}
        .dash-bar-bg { background: #eee; height: 6px; border-radius: 3px; overflow: hidden; }
        .dash-bar-fill { height: 100%; background: #4cd964; transition: width 0.3s; }
        .dash-bar-fill.danger { background: #ff3b30; }
        .modal-history-section { margin-top: 15px; border-top: 2px solid #f0f0f0; padding-top: 10px; height: auto; overflow: visible; }
        .modal-history-title { font-size: 12px; font-weight: 700; color: #555; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; }
        .history-item { padding: 10px 0; border-bottom: 1px solid #f9f9f9; display: flex; justify-content: space-between; align-items: center; font-size: 12px; cursor: pointer; }
        .history-item:active { background: #f5f5f5; }
        .history-item:last-child { border-bottom: none; }
        .h-name { font-weight: 600; color: #555; }
        .h-date { font-size: 10px; color: #aaa; margin-top: 2px;}
        .h-amount { font-weight: 700; color: #333; font-size: 13px; }
        .btn-delete-single { background: none; border: none; color: #ccc; font-size: 14px; padding: 0 5px; cursor: pointer; margin-left: 8px;}
        .btn-delete-single:hover { color: #FF3B30; }
    </style>
</head>
<body>
    <div id="welcomeModal" class="welcome-overlay">
        <div class="welcome-content">
            <div class="welcome-title">ğŸ‘‹ æ­¡è¿ä½¿ç”¨å›é¥‹ç®¡å®¶</div>
            <div class="welcome-desc">ç‚ºäº†æä¾›æœ€ç²¾æº–çš„æœå‹™<br>è«‹å‹¾é¸æ‚¨<b>ç›®å‰æŒæœ‰</b>çš„å¡ç‰‡ï¼š</div>
            <div class="welcome-list" id="welcomeList"></div>
            <button class="welcome-btn" onclick="saveWelcomeSettings()">é–‹å§‹ä½¿ç”¨ ğŸš€</button>
        </div>
    </div>

    <div class="app-container">
        <div class="header-top-row">
            <div class="author-top">Designed by Pocket Lab</div>
            <div class="version-tag">V124.02</div>
        </div>
        <div class="header-section">
            <h1>åˆ·å¡å›é¥‹ç®¡å®¶</h1>
            <div class="subtitle"><span class="today-date" id="dateDisplay"></span></div>
        </div>
        <div class="news-ticker">
            <div class="ticker-content" id="news-text">ğŸ‰ æ­¡è¿ä½¿ç”¨åˆ·å¡å›é¥‹ç®¡å®¶ï¼è¯é‚¦ç¶ å¡/å¹£å€å¡2026/å°‡å°‡å¡2026 æœ€æ–°æ¬Šç›Šå·²æ›´æ–°ã€‚</div>
        </div>
        <div id="urgent-alert-area"><div class="urgent-card"><div class="urgent-title">ğŸš¨ ä»»å‹™åˆ°æœŸè­¦å ±</div><div id="urgent-list"></div></div></div>
        <div class="total-reward-card">
            <div class="total-info">
                <span class="total-reward-label">ç•¶æœŸç´¯ç©å›é¥‹é ä¼°</span>
                <span class="total-reward-amount" id="totalRewardDisplay">$0</span>
            </div>
            <button class="btn-share-result" onclick="openShareModal()">ğŸ“© æ›¬æˆ°ç¸¾</button>
        </div>
        <div id="card-grid"></div>
        <div style="flex:1;"></div>
        <div class="settings-area">
            <div class="settings-row">
                <button class="btn-tool btn-manage" onclick="openManageModal()">ğŸ’³ ç®¡ç†æˆ‘çš„å¡ç‰‡</button>
            </div>
            <div class="settings-row">
                <button class="btn-tool" onclick="exportData()">ğŸ’¾ å‚™ä»½æª”æ¡ˆ</button>
                <button class="btn-tool" onclick="triggerImport()">ğŸ“¥ è®€æª”é‚„åŸ</button>
                <input type="file" id="fileInput" style="display:none" accept=".json, .txt" onchange="importFile(this)">
            </div>
            <button class="btn-ig" onclick="window.open('https://www.instagram.com/pocket_lab_tw', '_blank')">
                ğŸ“¸ æ­¡è¿è¿½è¹¤å£è¢‹å¯¦é©—å®¤
            </button>
            <button class="btn-reset-visible" onclick="resetAllData()">ğŸ—‘ï¸ é‡ç½®æ‰€æœ‰è³‡æ–™</button>
        </div>
    
        <div style="text-align:center; font-size:11px; color:#555; background:#ebebeb; padding:10px; border-radius:8px; margin-top:15px; margin-bottom:10px; line-height:1.4; font-weight:600;">
            âš ï¸ æœ¬å·¥å…·åƒ…å”åŠ©ç”¨æˆ¶ç›£æ§åˆ·å¡é€²åº¦<br>å¯¦éš›å…¥å¸³éœ€ä»¥å„å®¶éŠ€è¡Œåˆ¤å®šç‚ºä¸»
        </div>
        <div style="height:20px;"></div>
    </div>
    
    <div id="sharePreviewModal" class="modal" onclick="if(event.target===this) document.getElementById('sharePreviewModal').style.display='none'">
        <div class="modal-content" style="background:transparent; box-shadow:none; align-items:center; padding:0; width:100%; max-width:340px;">
            <div id="captureNode" class="share-card-node">
                <div class="share-header">Monthly Rewards</div>
                <div class="share-month" id="shareCardMonth">æˆ°ç¸¾å ±å‘Š</div>
                <div class="share-amount" id="shareCardAmount">$0</div>
                <div class="share-divider"></div>
                <div class="share-list" id="shareCardList"></div> 
                <div class="share-footer">
                    <div>Generated by åˆ·å¡å›é¥‹ç®¡å®¶</div>
                </div>
            </div>

            <div style="background:white; border-radius:20px; padding:15px; width:100%; box-sizing:border-box; box-shadow: 0 10px 30px rgba(0,0,0,0.3); margin-top:10px;">
                <div style="text-align:center; font-size:12px; color:#333; margin-bottom:12px; font-weight:700;">âœ¨ è«‹é¸æ“‡åˆ†äº«æ–¹å¼</div>
                <div class="social-btn-grid">
                    <button class="social-btn instagram" onclick="shareToIG()">ğŸ“¸ Instagram</button>
                    <button class="social-btn facebook" onclick="shareToFB()">ğŸ“˜ Facebook</button>
                    <button class="social-btn threads" onclick="shareToThreads()">ğŸ§µ Threads</button>
                    <button class="social-btn line" onclick="shareToLine()">ğŸŸ¢ LINE</button>
                    <button class="social-btn download" onclick="downloadShareImage()">ğŸ“¥ åƒ…ä¿å­˜åœ–ç‰‡</button>
                </div>
                <div style="text-align:center; font-size:10px; color:#999; margin-top:10px; line-height:1.4;">
                    (ç³»çµ±å°‡å–šèµ·åŸç”Ÿåˆ†äº«é¸å–®å‚³é€åœ–ç‰‡)
                </div>
            </div>
            <button style="margin-top:15px; background:none; border:none; color:white; font-size:14px; text-decoration:underline; cursor:pointer;" onclick="document.getElementById('sharePreviewModal').style.display='none'">é—œé–‰è¦–çª—</button>
        </div>
    </div>

    <div id="transactionModal" class="modal" onclick="if(event.target===this) closeModal()">
        <div class="modal-content">
            <div class="modal-body-input">
                <h2 id="modalTitle" style="margin: 0 0 4px 0; font-size: 18px; font-weight: 800; color:#333;"></h2>
                <div style="font-size:12px; color:#888; margin-bottom:10px; font-weight: 500;" id="modalSubtitle"></div>
                <div id="modalParkingInfo" style="background:#FFF9C4; color:#856404; padding:10px; border-radius:10px; font-size:12px; margin-bottom:12px; border-left:4px solid #FFC107; display:none; line-height:1.5;"></div>
                <input type="hidden" id="cardIdInput"> 
                
                <div id="pigRichOptions">
                    <div class="option-row read-only"><label id="labelBaseRate">ğŸ”° åŸºæœ¬å›é¥‹ 1% (ç„¡ä¸Šé™)</label><input type="checkbox" checked disabled></div>
                    <div class="option-row" style="flex-direction:column; align-items:flex-start; gap:0;">
                         <div style="display:flex; justify-content:space-between; width:100%; align-items:center;">
                            <label for="checkBonus10">âš¡ æ–°æˆ¶åŠ ç¢¼ +10% (é™åˆ·$8,000)</label>
                            <input type="checkbox" id="checkBonus10" checked onchange="updateRewardPreview()">
                        </div>
                        <button onclick="togglePigRichNewUser()" style="border:none; background:none; color:#007AFF; font-size:11px; cursor:pointer; padding:2px 0 6px 0;">ğŸ”½ é»æ“ŠæŸ¥çœ‹ 10% å®šç¾©</button>
                        <div id="pigRichNewUserDetails" class="details-content">
                            <b>â˜… è¡Œå‹•æ”¯ä»˜ï¼š</b><br>LINE Payã€è¡—å£æ”¯ä»˜ã€icash Pay (å«APPå…§ç¹³è²»)<br>
                            <b>â˜… æµ·å¤–æ¶ˆè²»ï¼š</b><br>å«å¯¦é«”åŠç·šä¸Šäº¤æ˜“ (éœ€éå°å¹£/éå°ç£)<br>
                            <b>â˜… æ©Ÿç¥¨ï¼š</b><br>åœ‹å…§å¤–èˆªç©ºå…¬å¸ (é™é€éèˆªç©ºå…¬å¸å®˜ç¶²è³¼è²·)
                        </div>
                    </div>

                    <div class="option-row" style="flex-direction:column; align-items:flex-start; gap:0; border-top:1px dashed #ddd; padding-top:6px;">
                        <div style="display:flex; justify-content:space-between; width:100%; align-items:center;">
                            <label for="checkBonus25">ğŸŒŸ ç²¾é¸é€šè·¯ +2.5% (é™åˆ·$40è¬)</label>
                            <input type="checkbox" id="checkBonus25" checked onchange="toggleSelectedLogic()">
                        </div>
                        <button onclick="togglePigRichSelected()" style="border:none; background:none; color:#007AFF; font-size:11px; cursor:pointer; padding:2px 0 6px 0;">ğŸ”½ é»æ“ŠæŸ¥çœ‹ç²¾é¸é€šè·¯</button>
                        <div id="pigRichSelectedDetails" class="details-content">
                            <b>(1) æ—…éŠäº¤é€š (2) ç”Ÿæ´»è³¼ç‰© (3) å¤–é€ç¾é£Ÿ (4) å½±åŸKæ­Œ</b>
                        </div>
                    </div>
                    <div class="option-row" style="margin-bottom:0; border-top:1px dashed #ddd; padding-top:6px;"><label for="checkIsBill">ğŸ§¾ APPç¹³è²» (åº•1%â†’0.15%)</label><input type="checkbox" id="checkIsBill" onchange="toggleBillLogic()"></div>
                </div>

                <div id="greenCardOptions">
                    <div class="option-row read-only"><label>ğŸ”° åœ‹å…§åŸºæœ¬ 1% (ç„¡ä¸Šé™)</label><input type="checkbox" checked disabled></div>
                    <div class="option-row" style="flex-direction:column; align-items:flex-start; gap:0; border-top:1px dashed #ddd; padding-top:6px;">
                        <div style="display:flex; justify-content:space-between; width:100%; align-items:center;">
                            <label for="checkGreenChannel">ğŸŒ¿ ç¶ è‰²é€šè·¯åŠ ç¢¼ +5% (é™åˆ·$3,000)</label>
                            <input type="checkbox" id="checkGreenChannel" onchange="toggleGreenLogic()">
                        </div>
                        <button onclick="toggleGreenDetails()" style="border:none; background:none; color:#007AFF; font-size:11px; cursor:pointer; padding:2px 0 6px 0;">ğŸ”½ é»æ“ŠæŸ¥çœ‹ç¶ è‰²é€šè·¯æ¸…å–®</button>
                        <div id="greenDetails" class="details-content">
                            <b>â˜… é›»å‹•æ±½/æ©Ÿè»Šï¼š</b><br>å…¨åœ‹ç‰¹æ€¥é›»ã€EVALUEã€EVOASISã€TESLAå……é›»ã€Gogoroé›»æ± è³‡è²»ã€eMovingé›»æ± è³‡è²»<br>
                            <b>â˜… å…±äº«äº¤é€šï¼š</b><br>iRentã€GoShareã€WeMo Scooter<br>
                            <b>â˜… ç”Ÿæ©Ÿé¸å“ï¼š</b><br>é‡Œä»ã€è–å¾·ç§‘æ–¯ã€AESOPã€10/10 HOPE<br>
                            <b>â˜… ç¶ è‰²æè´ˆï¼š</b><br>ä¸­è¯æ°‘åœ‹è’é‡ä¿è­·å”æœƒã€å°ç£åƒé‡Œæ­¥é“å”æœƒã€çœ‹è¦‹é½ŠæŸæ—åŸºé‡‘æœƒã€ä¸»å©¦è¯ç›Ÿç’°å¢ƒä¿è­·åŸºé‡‘æœƒ
                        </div>
                    </div>
                    <div class="option-row" style="margin-top:6px; border-top:1px dashed #ddd; padding-top:6px; margin-bottom:0;">
                        <label for="checkForeign">âœˆï¸ åœ‹å¤–æ¶ˆè²» 2% (åŸºæœ¬1%+åŠ ç¢¼1%)</label>
                        <input type="checkbox" id="checkForeign" onchange="toggleForeignLogic()">
                    </div>
                </div>
                
                <div id="uniOptions">
                    <div class="option-row read-only"><label id="labelUniBase">ğŸ”° ä»»æ„é¸ 3.5% (é™åˆ·$4è¬)</label><input type="checkbox" checked disabled></div>
                    <div class="option-row"><label for="checkUniUp">ğŸ†™ è¨‚é–± UP é¸ 4.5% (é™åˆ·$14è¬)</label><input type="checkbox" id="checkUniUp" onchange="toggleUniUpLogic()"></div>
                    <div class="option-row" style="margin-top:6px; border-top:1px dashed #ddd; padding-top:6px; margin-bottom:0;"><label for="checkUniBonus">ğŸ”¥ çµ±ä¸€æ™‚ä»£ä»»å‹™ +3% (é™åˆ·$1.6è¬)</label><input type="checkbox" id="checkUniBonus" onchange="updateRewardPreview()"></div>
                </div>
                
                <div id="uniOpenOptions">
                    <div class="option-row read-only"><label>ğŸ”° åŸºæœ¬å›é¥‹ 1% (ç„¡ä¸Šé™)</label><input type="checkbox" checked disabled></div>
                    <div class="option-row"><label for="checkUniGroup">ğŸª çµ±ä¸€é›†åœ˜ +2% (é™åˆ·$2.5è¬)</label><input type="checkbox" id="checkUniGroup" onchange="toggleUniGroup()"></div>
                    <div class="option-row"><label for="checkUniIcash">ğŸ“± icash Pay +4% (é™åˆ·$3,750)</label><input type="checkbox" id="checkUniIcash" onchange="toggleUniIcash()"></div>
                    
                    <div class="option-row" style="border-top:1px dashed #ddd; padding-top:6px; margin-top:6px; flex-direction:column; align-items:flex-start;">
                        <label style="margin-bottom:4px;">ğŸƒ è¸©é»ä»»å‹™ (2å®¶èµ·è·³ï¼Œæœ€é«˜+4%)</label>
                        <div class="brand-grid" id="uniBrandGrid"></div>
                        <div style="font-size:10px; color:#FF9800; margin-top:6px; font-weight:700;" id="taskBonusDisplay">ç›®å‰ 0 å®¶ (åŠ ç¢¼ 0%)</div>
                    </div>
                    <div class="option-row" style="margin-top:6px; border-top:1px dashed #ddd; padding-top:6px;">
                        <label for="checkUniOverseas">âœˆï¸ æµ·å¤–å¯¦é«” 11% (é™åˆ·$6,250)</label>
                        <input type="checkbox" id="checkUniOverseas" onchange="toggleUniOverseas()">
                    </div>
                </div>
                
                <div id="jiangOptions">
                    <div class="option-row read-only" style="background:#eee; padding:8px; border-radius:6px; margin-bottom:8px;"><label>ğŸ”° åŸºæœ¬å›é¥‹ 0.5% (ç„¡ä¸Šé™)</label><input type="radio" name="jiangMode" value="base" checked onchange="updateRewardPreview()"></div>
                    
                    <div class="option-row" style="flex-direction:column; align-items:flex-start; gap:0px; border-top:1px dashed #ddd; padding-top:8px;">
                        <div style="display:flex; justify-content:space-between; width:100%; align-items:center; margin-bottom:4px;">
                            <label for="rbJiangSelected">ğŸ›ï¸ ç”Ÿæ´»å‡ç´š +4.5% (é™åˆ·$6,666)</label>
                            <input type="radio" name="jiangMode" id="rbJiangSelected" value="selected" onchange="updateRewardPreview()">
                        </div>
                        <button onclick="toggleJiangDetails()" style="border:none; background:none; color:#007AFF; font-size:11px; cursor:pointer; padding:0 0 6px 0;">ğŸ”½ é»æ“ŠæŸ¥çœ‹æŒ‡å®šé€šè·¯æ¸…å–®</button>
                        <div id="jiangDetails" class="details-content">
                            <b>(1) Aiå·¥å…·åŠæ•¸ä½å·¥å…·ï¼š</b><br>ChatGPTã€Canvaã€Claudeã€Cursorã€Duolingoã€Gammaã€Geminiã€Notionã€Perplexityã€Speakã€Apple åª’é«”æœå‹™ã€Google Play<br>
                            <b>(2) å­¸ç¿’å¹³å°ï¼š</b><br>Hahowã€Udemyã€VoiceTubeã€PressPlayã€AmazingTalkerã€Readmooã€æ™ºåŸºç§‘æŠ€(å­¸æ€é…·)<br>
                            <b>(3) åœ‹å…§å¤–é€å¹³å°(ä¸å«æœƒå“¡è²»ç”¨)ï¼š</b><br>Uber Eatsã€foodpanda<br>
                            <b>(4) ç”Ÿæ´»å®¶å±…ï¼š</b><br>IKEAå®œå®¶å®¶å±…ã€ç‰¹åŠ›å±‹ã€HOLA<br>
                            <b>(5) æŒ‡å®šè¶…å•†è¶…å¸‚ï¼š</b><br>7-ELEVEN å¯¦é«”é–€å¸‚(icash payã€è¡—å£æ”¯ä»˜ã€æ©˜å­æ”¯ä»˜)ã€å…¨å®¶ä¾¿åˆ©å•†åº—(è¡—å£æ”¯ä»˜)ã€å®¶æ¨‚ç¦<br>
                            <b>(6) é‹å‹•å¥èº«ï¼š</b><br>World Gymã€BEING Fitã€Curvesã€å¥èº«å·¥å» <br>
                            <b>(7) åœ‹å…§é¤å»³ï¼š</b><br>åœ‹å…§é¤å»³(MCC 5811/5812/5814/5462)ã€é€£é–é€Ÿé£Ÿï¼éº¥ç•¶å‹<br>
                            <b>(8) è¡Œå‹•æ”¯ä»˜ï¼š</b><br>LINE Payã€è¡—å£æ”¯ä»˜ã€icash Payã€æ©˜å­æ”¯ä»˜ã€æ‚ éŠä»˜ã€Hami Payã€PiéŒ¢åŒ…ã€TWQR<br>
                            <b>(9) äº¤é€šï¼š</b><br>ä¸€å¡é€šè‡ªå‹•åŠ å€¼ã€é«˜éµ(å«é«˜éµappç·šä¸Šåˆ·å¡)
                        </div>
                    </div>
                    
                    <div class="option-row" id="jiangTravelRow" style="border-top:1px dashed #ddd; padding-top:8px; margin-top:4px; flex-direction:column; align-items:flex-start;">
                         <div style="display:flex; justify-content:space-between; width:100%; align-items:center;">
                            <label for="rbJiangTravel">âœˆï¸ æ—…éŠåŠ ç¢¼ +4.5% (é™åˆ·$1.1è¬)</label>
                            <input type="radio" name="jiangMode" id="rbJiangTravel" value="travel" onchange="updateRewardPreview()">
                        </div>
                        <button onclick="toggleJiangTravelDetails()" style="border:none; background:none; color:#007AFF; font-size:11px; cursor:pointer; padding:2px 0 6px 0;">ğŸ”½ é»æ“ŠæŸ¥çœ‹æ—…éŠ/èˆªç©º/æ—…è¡Œç¤¾</button>
                        <div id="jiangTravelDetails" class="details-content">
                            <b>(1) æµ·å¤–åŠèˆªç©ºï¼š</b><br>æ¶ˆè²»åœ‹åˆ¥éå°ç£æˆ–å¹£åˆ¥éå°å¹£ã€èˆªç©º MCC 3000~3350/4511/4723<br>(æ˜Ÿå®‡ã€è¯èˆªã€é•·æ¦®ã€åœ‹æ³°ã€è™èˆªã€é˜¿è¯é…‹ã€é…·èˆªã€æ¨‚æ¡ƒã€æ·æ˜Ÿã€æ—¥èˆªã€ANAã€äºèˆªã€è¯åˆã€è¶Šæ·ã€å¤§éŸ“ã€é”ç¾ã€åœŸè€³å…¶ã€å¡é”ã€æ³•èˆª)<br>
                            <b>(2) æ—…è¡Œç¤¾ï¼š</b><br>æ˜“éŠç¶²ã€é›„ç…ã€å¯æ¨‚ã€æ±å—ã€äº”ç¦ã€ç‡¦æ˜Ÿã€å±±å¯Œã€é•·æ±ã€é³³å‡°ã€æ˜“é£›ç¶²ã€ç†æƒ³ã€æ°¸åˆ©ã€ä¸‰è³€
                        </div>
                    </div>
                    <div id="jiangTravelExpMsg" style="font-size:10px; color:#d32f2f; margin-top:2px; display:none;">âš ï¸ æ´»å‹•å·²æ–¼ 3/31 çµæŸ</div>
                </div>

                <div id="happyOptions">
                     <div class="option-row read-only"><label>ğŸ”° ä¸€èˆ¬æ¶ˆè²» 0.5% (ç„¡ä¸Šé™)</label><input type="checkbox" checked disabled></div>
                     
                     <div class="option-row" style="flex-direction:column; align-items:flex-start; gap:0;">
                        <div style="display:flex; justify-content:space-between; width:100%; align-items:center;">
                            <label for="checkHappyPet">ğŸ¶ å¯µç‰©é€šè·¯ +9.5% (é™åˆ·$5,263)</label>
                            <input type="checkbox" id="checkHappyPet" onchange="toggleHappyPet()">
                        </div>
                        <button onclick="toggleHappyPetDetails()" style="border:none; background:none; color:#007AFF; font-size:11px; cursor:pointer; padding:2px 0 6px 0;">ğŸ”½ é»æ“ŠæŸ¥çœ‹å¯µç‰©é€šè·¯</button>
                        <div id="happyPetDetails" class="details-content">
                            <b>(1) æŒ‡å®šå¯µç‰©é€£é–ï¼š</b><br>å¯µç‰©å…¬åœ’ã€æ±æ£®å¯µç‰©ã€é­šä¸­é­šã€è²“ç‹—éšŠé•·ã€æ¯›å­©å¸‚é›†ã€é‡‘å‰åˆ©ã€å¥½ç‹—å‘½ã€å¥½ç‹—é‹ã€é‡‘ç‹å­ã€æ„›è²“åœ’ã€ç¦å£½å¯µç‰©æ——è‰¦é¤¨<br>
                            <b>(2) 2026 æ–°å¢å“ç‰Œï¼š</b><br>æ±ªå–µæ˜Ÿçƒã€æ€ªç¸éƒ¨è½ã€è¶…å‡å°å§ã€Hero Mama<br>
                            <b>(3) é†«ç™‚èˆ‡ç¾å®¹ï¼š</b><br>ç¸é†«è¨ºæ‰€ã€å‹•ç‰©é†«é™¢ã€å¯µç‰©æ—…é¤¨ã€å¯µç‰©ç¾å®¹ (MCC 0742, 5995)
                        </div>
                     </div>

                     <div class="option-row" style="flex-direction:column; align-items:flex-start; gap:0; border-top:1px dashed #ddd; padding-top:6px;">
                        <div style="display:flex; justify-content:space-between; width:100%; align-items:center;">
                            <label for="checkHappyPeace">ğŸ½ï¸ å¤§å°å®‰å¿ƒåˆ· +3.5% (é™åˆ·$5,714)</label>
                            <input type="checkbox" id="checkHappyPeace" onchange="toggleHappyPeace()">
                        </div>
                        <button onclick="toggleHappyPeaceDetails()" style="border:none; background:none; color:#007AFF; font-size:11px; cursor:pointer; padding:2px 0 6px 0;">ğŸ”½ é»æ“ŠæŸ¥çœ‹é¤å»³/è—¥å±€/å±…å®¶</button>
                        <div id="happyPeaceDetails" class="details-content">
                            <b>(1) åœ‹å…§é¤å»³ï¼š</b><br>åœ‹å…§å„å¤§æŒ‡å®šé¤å»³ (MCC 5811, 5812, 5813, 5814)<br>
                            <b>(2) å©¦å¹¼è—¥å±€/å±…å®¶ï¼š</b><br>å¤§æ¨¹ã€æä¸€ã€ç¶­åº·ã€èºç…ã€å¡å¤šæ‘©ã€å®œå…’æ¨‚ã€ç‡Ÿé¤ŠéŠ€è¡Œã€éº—å…’é‡‡å®¶ã€åª½å’ªæ¨‚å±…å®¶æœå‹™ã€æ½”å®¢å¹«<br>
                            <b>(3) é‹å‹•å¥èº«ï¼š</b><br>ä½ç™»å¦®çµ²ã€å¥èº«å·¥å» ã€World Gymã€BEING spaã€BEING sportã€Curveså¯çˆ¾å§¿
                        </div>
                     </div>

                     <div class="option-row" style="flex-direction:column; align-items:flex-start; gap:0; border-top:1px dashed #ddd; padding-top:6px;">
                        <div style="display:flex; justify-content:space-between; width:100%; align-items:center;">
                            <label for="checkHappyLife">ğŸ›’ ç”Ÿæ´»ç¦®é‡ +3.5% (é™åˆ·$5,714)</label>
                            <input type="checkbox" id="checkHappyLife" onchange="toggleHappyLife()">
                        </div>
                        <button onclick="toggleHappyLifeDetails()" style="border:none; background:none; color:#007AFF; font-size:11px; cursor:pointer; padding:2px 0 6px 0;">ğŸ”½ é»æ“ŠæŸ¥çœ‹ç™¾è²¨/é‡è²©/äº¤é€š</button>
                        <div id="happyLifeDetails" class="details-content">
                            <b>(1) ç™¾è²¨/Outletï¼š</b><br>é æ±ç™¾è²¨ã€SOGOã€å·¨åŸã€å¤§é ç™¾ã€å—ç´¡ã€å¤¢æ™‚ä»£ã€skmparkã€å°šé †ã€å¤§é­¯é–£(æ¹³é›…)ã€æ¡ƒçŸ¥é“ã€å¤§æ±Ÿã€å°èŒ‚ã€æ–°æœˆã€é é›„ã€å®åŒ¯ã€CITYLINKã€ç¾éº—è¯ã€å¤§è‘‰é«˜å³¶å±‹ã€çµ±ä¸€æ™‚ä»£ã€æ•…å®®ã€ç§€æ³°ã€ç’°çƒã€IKEAã€éº—å¯¶ã€LaLaport<br>
                            <b>(2) è¶…å¸‚é‡è²©/ç”Ÿæ©Ÿï¼š</b><br>æ„›è²·ã€å®¶æ¨‚ç¦ã€ç¾å»‰ç¤¾ã€å°åŒ—ã€å¤§è²·å®¶ã€å–œäº’æƒ ã€æ£‰èŠ±ç”°ã€è–å¾·ç§‘æ–¯ã€æ°¸è±é¤˜ç”ŸæŠ€ã€é‡Œä»ã€å°ç£ä¸»å©¦è¯ç›Ÿã€å¥åº·é£Ÿå½©ã€å®‰éº—ã€è‘¡çœ¾ã€ç¾æ¨‚å®¶<br>
                            <b>(3) äº¤é€šé›»ä¿¡ï¼š</b><br>åœ‹å…§åŠ æ²¹(ä¸­æ²¹/å°äº/å°å¡‘)ã€gogoroã€Teslaã€å°ç£å¤§è»ŠéšŠã€yoxiã€Uber(å°ç£)ã€GoShareã€iRentã€WeMoã€é å‚³/å°å“¥å¤§å¸³å–®<br>
                            <b>(4) æ•™è‚²/æ›¸åº—ï¼š</b><br>å°ç£è”¦å±‹ã€èª å“ã€åšå®¢ä¾†ã€é‡‘çŸ³å ‚ã€å·¨åŒ ã€è¯æˆã€æœ±å®—æ…¶ã€é›²é–€
                        </div>
                     </div>

                     <div class="option-row" style="margin-top:6px; border-top:1px dashed #ddd; padding-top:6px; margin-bottom:0;"><label for="checkHappyForeign">âœˆï¸ åœ‹å¤–æ¶ˆè²» +2% (ç„¡ä¸Šé™)</label><input type="checkbox" id="checkHappyForeign" onchange="toggleHappyForeign()"></div>
                    <div id="happyDashboard" class="happy-dashboard"></div>
                </div>

                <div id="hsbcOptions">
                     <div class="option-row" style="border-bottom:1px solid #eee; padding-bottom:10px; margin-bottom:10px;">
                        <span style="font-weight:700; color:#333;">ğŸ’³ é¸æ“‡æ‚¨çš„å¡ç‰‡ç­‰ç´š (è‡ªå‹•è¨˜æ†¶)ï¼š</span>
                        <div style="display:flex; gap:15px; margin-top:8px;">
                            <label style="display:flex; align-items:center; font-weight:normal; font-size:13px;"><input type="radio" name="hsbcTier" value="infinite" onchange="saveHsbcTier()"> ç„¡é™å¡</label>
                            <label style="display:flex; align-items:center; font-weight:normal; font-size:13px;"><input type="radio" name="hsbcTier" value="signature" onchange="saveHsbcTier()"> å¾¡ç’½å¡</label>
                        </div>
                    </div>
                    <div class="option-row"><label for="hsbcInitialMiles">ğŸ å·²æœ‰å“©ç¨‹ (èµ·å§‹å€¼)</label><input type="number" id="hsbcInitialMiles" onchange="saveHsbcInitial()" style="text-align:right; width: 100px; border:1px solid #ccc; border-radius:4px; padding:4px;" placeholder="0"></div>
                    <div class="option-row"><label for="hsbcRedeemedMiles" style="color:#d32f2f;">â– å·²å…Œæ›å“©ç¨‹</label><input type="number" id="hsbcRedeemedMiles" onchange="saveHsbcSettings()" style="text-align:right; width: 100px; border:1px solid #ffcdd2; color:#d32f2f; border-radius:4px; padding:4px;" placeholder="0"></div>
                     <div class="option-row" style="margin-top:10px; border-top:1px dashed #ddd; padding-top:6px;"><label for="checkHsbcForeign">âœˆï¸ åœ‹å¤–æ¶ˆè²»</label><input type="checkbox" id="checkHsbcForeign" onchange="updateRewardPreview()"></div>
                </div>
                
                <div id="richartOptions">
                    <div style="font-size:12px; color:#D32F2F; background:#FFEBEE; padding:8px; border-radius:6px; margin-bottom:10px; font-weight:700; border:1px solid #FFCDD2;">
                        âš ï¸ éœ€ç¶å®š Richart å¸³æˆ¶è‡ªå‹•æ‰£ç¹³ (æœªç¶åƒ…0.3%)
                    </div>
                    <div class="option-row"><label for="rbRichartGeneral">ğŸ”° ä¸€èˆ¬æ¶ˆè²» (0.3%)</label><input type="radio" name="richartMode" id="rbRichartGeneral" value="general" checked onchange="toggleRichartLogic()"></div>
                    <div class="option-row"><label for="rbRichartPay">ğŸ“± å°æ–°Pay/Pay+ (3.8%)</label><input type="radio" name="richartMode" id="rbRichartPay" value="pay" onchange="toggleRichartLogic()"></div>
                    <div class="option-row"><label for="rbRichartOnline">ğŸ›ï¸ æŒ‡å®šç¶²è³¼/å½±éŸ³ (3.3%)</label><input type="radio" name="richartMode" id="rbRichartOnline" value="online" onchange="toggleRichartLogic()"></div>
                    <div class="option-row"><label for="rbRichartLine">ğŸŸ¢ LINE Pay (2.3%)</label><input type="radio" name="richartMode" id="rbRichartLine" value="line" onchange="toggleRichartLogic()"></div>
                    <div class="option-row" style="border-top:1px dashed #ddd; margin-top:6px; padding-top:6px;"><label for="rbRichartOverseas">âœˆï¸ æµ·å¤–æ¶ˆè²» (3.3%)</label><input type="radio" name="richartMode" id="rbRichartOverseas" value="overseas" onchange="toggleRichartLogic()"></div>
                    <div style="font-size:10px; color:#555; margin-top:8px; opacity:0.8;">
                        ğŸ’¡ å°æ’‡æ­¥ï¼šè‹¥ç¶²è³¼ä½¿ç”¨å°æ–°Payï¼Œè«‹å‹¾é¸ã€Œå°æ–°Pay (3.8%)ã€
                    </div>
                </div>

                <div id="fubonJOptions">
                    <div class="option-row read-only"><label id="labelFubonBase">ğŸ”° åœ‹å…§æ¶ˆè²» 1% (ç„¡ä¸Šé™)</label><input type="checkbox" checked disabled></div>
                    <div class="option-row"><label for="checkFubonJJapan">ğŸ‡¯ğŸ‡µ åˆ‡æ›ç‚ºæ—¥éŸ“æ¶ˆè²» (3%)</label><input type="checkbox" id="checkFubonJJapan" onchange="toggleFubonJLogic()"></div>
                    <div class="option-row" id="rowFubonPhysical" style="border-top:1px dashed #ddd; padding-top:6px;"><label for="checkFubonJPhysical">ğŸ›ï¸ ç•¶åœ°å¯¦é«” +3% (é™åˆ·$3.3è¬)</label><input type="checkbox" id="checkFubonJPhysical" onchange="updateRewardPreview()"></div>
                    <div class="option-row" id="rowFubonDomesticBonus" style="border-top:1px dashed #ddd; padding-top:6px;"><label for="checkFubonJDomesticBonus">ğŸª åœ‹å…§æŒ‡å®š +3% (é™åˆ·$1è¬)</label><input type="checkbox" id="checkFubonJDomesticBonus" onchange="updateRewardPreview()"></div>
                </div>
                <div id="jiheOptions">
                    <div class="option-row read-only"><label id="labelJiheBase">ğŸ”° åœ‹å…§æ¶ˆè²» 1% (ç„¡ä¸Šé™)</label><input type="checkbox" checked disabled></div>
                    <div class="option-row"><label for="checkJiheJapan">ğŸ‡¯ğŸ‡µ åˆ‡æ›ç‚ºæ—¥æœ¬æ¶ˆè²» (2.5%)</label><input type="checkbox" id="checkJiheJapan" onchange="toggleJiheLogic()"></div>
                    <div class="option-row" id="rowJiheApple" style="border-top:1px dashed #ddd; padding-top:6px;"><label for="checkJiheApple">ğŸ Apple Pay +1.5% (é™åˆ·$4è¬)</label><input type="checkbox" id="checkJiheApple" onchange="updateRewardPreview()"></div>
                    <div class="option-row" id="rowJiheDomesticJapanese" style="border-top:1px dashed #ddd; padding-top:6px;"><label for="checkJiheDomesticJapanese">ğŸ‡¹ğŸ‡¼ åœ‹å…§æ—¥ç³» +4% (é™åˆ·$1.25è¬)</label><input type="checkbox" id="checkJiheDomesticJapanese" onchange="updateRewardPreview()"></div>
                </div>
                <div id="kumamonOptions">
                    <div class="option-row read-only"><label id="labelKumamonBase">ğŸ”° åœ‹å…§æ¶ˆè²» 1% (ç„¡ä¸Šé™)</label><input type="checkbox" checked disabled></div>
                    <div class="option-row"><label for="checkKumamonJapan">ğŸ‡¯ğŸ‡µ åˆ‡æ›ç‚ºæ—¥æœ¬æ¶ˆè²» (2%)</label><input type="checkbox" id="checkKumamonJapan" onchange="toggleKumamonLogic()"></div>
                    <div id="groupKumamonJapan" style="display:none;">
                        <div class="option-row" style="border-top:1px dashed #ddd; padding-top:6px;"><label for="checkKumamonDesignated">ğŸ» æŒ‡å®š/Suica +6.5% (é™åˆ·$1è¬)</label><input type="checkbox" id="checkKumamonDesignated" onchange="toggleKumamonSub()"></div>
                        <div class="option-row"><label for="checkKumamonPayPay">ğŸ“± PayPayæ”¯ä»˜ +3% (é™åˆ·$1è¬)</label><input type="checkbox" id="checkKumamonPayPay" onchange="toggleKumamonSub()"></div>
                    </div>
                    
                    <div id="groupKumamonDomestic">
                        <div class="option-row" style="border-top:1px dashed #ddd; padding-top:6px;"><label for="checkKumamonDomesticGreen">ğŸ‡¹ğŸ‡¼ åœ‹å…§æŒ‡å®š +1% (é™åˆ·$1è¬)</label><input type="checkbox" id="checkKumamonDomesticGreen" onchange="updateRewardPreview()"></div>
                    </div>
                </div>
                
                <div id="sinopacCurrencyOptions">
                    <div class="option-row" style="background:#eee; padding:8px; border-radius:6px; margin-bottom:8px; flex-direction:column; align-items:flex-start;">
                         <label style="margin-bottom:4px; color:#555;">ğŸ’° é¸æ“‡è³‡æ ¼ç­‰ç´š (è‡ªå‹•è¨˜æ†¶)</label>
                         <div style="display:flex; gap:10px; width:100%;">
                             <label style="font-weight:normal; font-size:12px; display:flex; align-items:center;"><input type="radio" name="currencyLevel" value="low" onchange="saveCurrencyLevel()" checked> Level 1 (é™åˆ·$7,500)</label>
                             <label style="font-weight:normal; font-size:12px; display:flex; align-items:center;"><input type="radio" name="currencyLevel" value="high" onchange="saveCurrencyLevel()"> Level 2 (é™åˆ·$20,000)</label>
                         </div>
                         <div style="font-size:10px; color:#999; margin-top:2px;">Level 1: è‡ªå‹•æ‰£ç¹³+é›»å­å¸³å–® | Level 2: å¾€ä¾†è³‡ç”¢â‰¥10è¬æˆ–å¤§æˆ¶</div>
                    </div>

                    <div class="option-row"><label>ğŸ”° åœ‹å…§ä¸€èˆ¬ (1%)</label><input type="radio" name="currencyType" value="domestic" checked onchange="toggleCurrencyLogic()"></div>

                    <div class="option-row" style="border-top:1px dashed #ddd; padding-top:6px; flex-direction:column; align-items:flex-start;">
                        <div style="display:flex; justify-content:space-between; width:100%; align-items:center;">
                            <label for="rbCurrencySelected">ğŸ›ï¸ ç²¾é¸/æµ·å¤– +4% (é™åˆ·$7,500/2è¬)</label>
                            <input type="radio" name="currencyType" id="rbCurrencySelected" value="selected" onchange="toggleCurrencyLogic()">
                        </div>
                        <button onclick="toggleCurrencyDetails()" style="border:none; background:none; color:#007AFF; font-size:11px; cursor:pointer; padding:0 0 6px 0;">ğŸ”½ é»æ“ŠæŸ¥çœ‹ç²¾é¸é€šè·¯</button>
                        <div id="currencyDetails" class="details-content">
                            <b>(1) åœ‹å¤–å¯¦é«”ï¼š</b><br>éå°ç£åœ°å€ä¸”éå°å¹£ä¹‹ä¸€èˆ¬äº¤æ˜“<br>
                            <b>(2) ç¶²è³¼æ¶ˆè²»ï¼š</b><br>Suica/PASMO/ICOCAå„²å€¼ã€Amazonã€Rakutenã€æ·˜å¯¶ã€eBayã€Gmarketã€iHerbã€Selfridgeã€Mercariã€å¤§åœ‹è—¥å¦ã€Sugiè—¥å¦ã€Olive Young<br>
                            <b>(3) æ—…éŠé€šè·¯ï¼š</b><br>èˆªç©ºå…¬å¸ã€æ—…è¡Œç¤¾ã€Booking.comã€Agodaã€Hotels.comã€Expediaã€Trip.comã€Airbnbã€Klookã€KKdayã€Trivagoã€AsiaYoã€æ­ç‰¹å„€æ¾å±±æ©Ÿå ´åœè»Š
                        </div>
                    </div>
                </div>

                <div id="sinopacMitsuiOptions">
                    <div class="option-row read-only"><label id="labelMitsuiBase">ğŸ”° ä¸€èˆ¬æ¶ˆè²» 0.3% (é¤¨å¤–/åœ‹å¤–)</label><input type="checkbox" checked disabled></div>
                    
                    <div class="option-row" style="border-top:1px dashed #ddd; padding-top:6px; display:flex; flex-direction:column; align-items:flex-start;">
                        <div style="display:flex; justify-content:space-between; width:100%; align-items:center;">
                            <label for="checkSinopacMitsuiSelected">ğŸ½ï¸ ç‰¹é¸é€šè·¯ 7% (é™åˆ·$1,428)</label>
                            <input type="checkbox" id="checkSinopacMitsuiSelected" onchange="updateRewardPreview()">
                        </div>
                        <div style="font-size:10px; color:#aaa; margin-top:2px; line-height:1.3;">
                            é€šè·¯ï¼šé¤¨å¤–é¤é£²(MCC 58xx) / å…¨ç›ˆ+PAY<br>
                            <span style="color:#d32f2f; font-weight:bold;">âš ï¸ ä¸Šé™åƒ… 100 å…ƒ (ç´„åˆ· $1,428)</span>
                        </div>
                    </div>
                    
                    <div class="option-row" style="background:#fff3e0; padding:8px; border-radius:6px; margin-top:6px;"><label for="checkSinopacMitsuiTarget">ğŸ‡¯ğŸ‡µ æ—¥éŸ“æ³°å¯¦é«” (æ¯å­£æ»¿3è¬é€2000)</label><input type="checkbox" id="checkSinopacMitsuiTarget" onchange="updateRewardPreview()"></div>
                </div>
                
                <div class="input-group" style="margin-top:15px; border-top:1px solid #eee; padding-top:15px;">
                    <label style="margin-bottom:4px;">ğŸ“… æ¶ˆè²»æ—¥æœŸ</label>
                    <input type="date" id="dateInput" style="font-size:16px; padding:8px; text-align:left;">
                </div>

                <div class="input-group" style="margin-top:10px;">
                    <input type="number" id="amountInput" placeholder="$ é‡‘é¡" inputmode="numeric" style="font-size:28px; text-align:center; border:none; border-bottom:2px solid #eee; border-radius:0;" oninput="updateRewardPreview()" onkeyup="updateRewardPreview()" onpaste="updateRewardPreview()">
                </div>
                
                <div id="liveRewardCalc"></div>
                <div class="input-group"><input type="text" id="noteInput" placeholder="å‚™è¨» (ä¾‹å¦‚: åˆé¤)"></div>
                <div class="btn-group">
                    <button class="btn btn-cancel" onclick="document.getElementById('transactionModal').style.display='none'">å–æ¶ˆ</button>
                    <button class="btn btn-again" onclick="addTransaction(false)">ğŸ”„ å†è¨˜ä¸€ç­†</button>
                    <button class="btn btn-confirm" id="btn-confirm" onclick="addTransaction(true)">ç¢ºèª</button>
                </div>
            </div>
            <div class="modal-history-section">
                <div class="modal-history-title" id="modalHistoryTitle"><span>ğŸ“… æœ¬æœˆæ¶ˆè²»ç´€éŒ„</span><span style="font-weight:normal; font-size:10px; color:#aaa;">(é»æ“Šæ–‡å­—ä¿®æ”¹ / âœ• åˆªé™¤)</span></div>
                <div id="modalHistoryList"></div>
            </div>
        </div>
    </div>
    <div id="manageModal" class="modal" onclick="if(event.target===this) document.getElementById('manageModal').style.display='none'">
        <div class="modal-content" style="max-height:80vh; overflow-y:auto;">
            <h2 style="margin: 0 0 4px 0; font-size: 18px; font-weight: 800; color:#333;">ç®¡ç†æˆ‘çš„å¡ç‰‡</h2>
            <div style="font-size:12px; color:#888; margin-bottom:12px;">é–‹å•Ÿ / éš±è—æ‚¨çš„å¡ç‰‡ (å³æ™‚ç”Ÿæ•ˆ)</div>
            <div id="manageCardList" style="border-top:1px solid #eee;"></div>
            <button class="btn btn-confirm" style="width:100%; margin-top:20px;" onclick="document.getElementById('manageModal').style.display='none'">å®Œæˆ</button>
        </div>
    </div>
<script>
    // è‡ªå‹•æ³¨å…¥é æ±æ¨‚å®¶+å¡å®Œæ•´é€šè·¯ (é˜²å‘†ä¿éšª)
    function injectHappyDetails() {
        const petDiv = document.getElementById('happyPetDetails');
        if(petDiv && petDiv.innerHTML.trim() === "") {
            petDiv.innerHTML = `
                <b>(1) æŒ‡å®šå¯µç‰©é€£é–ï¼š</b><br>å¯µç‰©å…¬åœ’ã€æ±æ£®å¯µç‰©ã€é­šä¸­é­šã€è²“ç‹—éšŠé•·ã€æ¯›å­©å¸‚é›†ã€é‡‘å‰åˆ©ã€å¥½ç‹—å‘½ã€å¥½ç‹—é‹ã€é‡‘ç‹å­ã€æ„›è²“åœ’ã€ç¦å£½å¯µç‰©æ——è‰¦é¤¨<br>
                <b>(2) 2026 æ–°å¢å“ç‰Œï¼š</b><br>æ±ªå–µæ˜Ÿçƒã€æ€ªç¸éƒ¨è½ã€è¶…å‡å°å§ã€Hero Mama<br>
                <b>(3) é†«ç™‚èˆ‡ç¾å®¹ï¼š</b><br>ç¸é†«è¨ºæ‰€ã€å‹•ç‰©é†«é™¢ã€å¯µç‰©æ—…é¤¨ã€å¯µç‰©ç¾å®¹ (MCC 0742, 5995)
            `;
        }
    }

    // --- è¯é‚¦ç¶ å¡å°ˆç”¨ä»‹é¢é‚è¼¯ (æ–°å¢æŠ˜ç–ŠåŠŸèƒ½) ---
    function toggleGreenDetails() {
        const el = document.getElementById('greenDetails');
        el.style.display = (el.style.display === 'block') ? 'none' : 'block';
    }

    function toggleGreenLogic() {
        if(document.getElementById('checkGreenChannel').checked) {
            document.getElementById('checkForeign').checked = false; // ç¶ è‰²èˆ‡åœ‹å¤–ä¸ä½µè¡Œ
        }
        updateRewardPreview();
    }

    function toggleForeignLogic() {
        if(document.getElementById('checkForeign').checked) {
            document.getElementById('checkGreenChannel').checked = false;
        }
        updateRewardPreview();
    }
    
    // --- Uni Open è¸©é»ä»»å‹™é‚è¼¯ (ä¿®å¾©æŒ‰éˆ•æ¶ˆå¤±å•é¡Œ) ---
    const uniBrands = ["7-11", "æ˜Ÿå·´å…‹", "åº·æ˜¯ç¾", "å®¶æ¨‚ç¦", "Mia C'bon", "åšå®¢ä¾†", "Yahooè³¼ç‰©", "é€Ÿé‚æ¨‚", "21ä¸–ç´€", "é…·è–çŸ³", "è–å¾·ç§‘æ–¯", "çµ±ä¸€æ™‚ä»£", "å¤¢æ™‚ä»£", "å…¶ä»–"];
    
    function initUniBrandGrid() {
        const grid = document.getElementById('uniBrandGrid');
        if(!grid) return;
        grid.innerHTML = '';
        uniBrands.forEach(brand => {
            const btn = document.createElement('div');
            btn.className = 'brand-btn';
            btn.innerText = brand;
            btn.onclick = () => toggleUniBrand(brand, btn);
            grid.appendChild(btn);
        });
    }

    function saveUniOpenState() {
        const state = {
            group: document.getElementById('checkUniGroup').checked,
            icash: document.getElementById('checkUniIcash').checked,
            overseas: document.getElementById('checkUniOverseas').checked,
            brands: getCheckedBrands()
        };
        localStorage.setItem('uniOpenState', JSON.stringify(state));
        const count = state.brands.length;
        updateTaskBonusDisplay(count);
        renderGrid(); 
        updateRewardPreview();
    }
    
    function toggleUniBrand(brand, btn) {
        if (document.getElementById('checkUniOverseas').checked) {
            document.getElementById('checkUniOverseas').checked = false;
        }
        // è‹¥é»æ“Šå“ç‰Œä½†å°šæœªå‹¾é¸çµ±ä¸€é›†åœ˜ï¼Œè‡ªå‹•å‹¾é¸
        if(!btn.classList.contains('active')) {
            document.getElementById('checkUniGroup').checked = true;
        }
        btn.classList.toggle('active');
        saveUniOpenState();
    }
    
    function toggleUniGroup() {
        if(document.getElementById('checkUniGroup').checked) {
            document.getElementById('checkUniOverseas').checked = false;
        }
        saveUniOpenState();
    }
    
    function toggleUniIcash() {
        if(document.getElementById('checkUniIcash').checked) {
            document.getElementById('checkUniOverseas').checked = false;
        }
        saveUniOpenState();
    }
    
    function getCheckedBrands() {
        const activeBtns = document.querySelectorAll('.brand-btn.active');
        const brands = [];
        activeBtns.forEach(btn => brands.push(btn.innerText));
        return brands;
    }
    
    function updateTaskBonusDisplay(count) {
        const display = document.getElementById('taskBonusDisplay');
        let rate = 0;
        if(count >= 5) rate = 4;
        else if(count === 4) rate = 3;
        else if(count === 3) rate = 2;
        else if(count === 2) rate = 1;
        display.innerText = `ç›®å‰è¸©é» ${count} å®¶ (åŠ ç¢¼ +${rate}%)`;
    }
    
    function toggleUniOverseas() {
        const isOverseas = document.getElementById('checkUniOverseas').checked;
        if (isOverseas) {
            document.getElementById('checkUniGroup').checked = false;
            document.getElementById('checkUniIcash').checked = false;
            const btns = document.querySelectorAll('.brand-btn');
            btns.forEach(btn => btn.classList.remove('active'));
        }
        saveUniOpenState();
    }

    // --- æ›¬æˆ°ç¸¾åŠŸèƒ½æ ¸å¿ƒé‚è¼¯ ---
    function openShareModal() {
        const totalAmount = document.getElementById('totalRewardDisplay').innerText;
        const date = new Date();
        const month = date.getMonth() + 1;
        
        document.getElementById('shareCardMonth').innerText = `${month} æœˆå›é¥‹æˆ°ç¸¾`;
        document.getElementById('shareCardAmount').innerText = totalAmount;
        
        let cardRewards = [];
        cards.forEach(card => {
            if(card.type === 'placeholder') return;
            const stats = calculateStats(card.id);
            if(stats.reward > 0) {
                cardRewards.push({ name: card.name, reward: stats.reward });
            }
        });
        
        cardRewards.sort((a, b) => b.reward - a.reward);
        const listContainer = document.getElementById('shareCardList');
        listContainer.innerHTML = '';
        
        if(cardRewards.length === 0) {
             listContainer.innerHTML = '<div style="text-align:center; opacity:0.6; padding:10px;">æœ¬æœˆå°šç„¡å›é¥‹ç´€éŒ„</div>';
        } else {
            cardRewards.forEach(c => {
                let unit = (c.name.includes('æ—…äºº')) ? 'å“©' : 'å…ƒ';
                listContainer.innerHTML += `
                    <div class="share-item">
                        <span>${c.name}</span>
                        <span>+${c.reward.toLocaleString()} ${unit}</span>
                    </div>`;
            });
        }
        document.getElementById('sharePreviewModal').style.display = 'flex';
    }

    // --- åˆ†æµé‚è¼¯ (FB/IG å‚³åœ–ï¼ŒLINE/Threads å‚³é€£çµ) ---

    // 1. è¦–è¦ºçµ„ï¼šFB / IG (èµ°åŸç”Ÿå‚³åœ–)
    function shareToIG() { shareImageNative(); }
    function shareToFB() { shareImageNative(); }

    // 2. æ–‡å­—çµ„ï¼šLINE / Threads (èµ°é€£çµåˆ†äº«ï¼Œæœ€å¿«)
    function shareToLine() {
        const text = getShareText();
        window.open(`https://line.me/R/msg/text/?${encodeURIComponent(text)}`, '_blank');
    }

    function shareToThreads() {
        const text = getShareText();
        window.open(`https://www.threads.net/intent/post?text=${encodeURIComponent(text)}`, '_blank');
    }

    // å…±ç”¨å‡½å¼ï¼šåŸç”Ÿåœ–ç‰‡åˆ†äº«
    function shareImageNative() {
        const node = document.getElementById('captureNode');
        const originalTransform = node.style.transform;
        node.style.transform = 'none';

        const btns = document.querySelectorAll('.social-btn');
        btns.forEach(b => b.style.opacity = '0.5');

        html2canvas(node, {
            backgroundColor: null,
            scale: 2 
        }).then(canvas => {
            node.style.transform = originalTransform; 
            btns.forEach(b => b.style.opacity = '1'); 
            
            canvas.toBlob(async (blob) => {
                const file = new File([blob], `reward_${Date.now()}.png`, { type: "image/png" });
                if (navigator.share && navigator.canShare && navigator.canShare({ files: [file] })) {
                    try {
                        await navigator.share({
                            files: [file],
                            title: 'æˆ‘çš„åˆ·å¡æˆ°ç¸¾',
                            text: getShareText() 
                        });
                    } catch (err) { console.log('åˆ†äº«å·²å–æ¶ˆ'); }
                } else {
                    alert("æ‚¨çš„è£ç½®ä¸æ”¯æ´ç›´æ¥åˆ†äº«ï¼Œç³»çµ±å°‡è‡ªå‹•ç‚ºæ‚¨ä¸‹è¼‰åœ–ç‰‡ã€‚");
                    downloadShareImage(); 
                }
            });
        });
    }

    function downloadShareImage(callback) {
        const node = document.getElementById('captureNode');
        const originalTransform = node.style.transform;
        node.style.transform = 'none'; 
        html2canvas(node, { backgroundColor: null, scale: 2 }).then(canvas => {
            node.style.transform = originalTransform; 
            const link = document.createElement('a');
            link.download = `æˆ‘çš„å›é¥‹æˆ°ç¸¾_${new Date().getTime()}.png`;
            link.href = canvas.toDataURL();
            link.click();
            if(callback) callback();
        });
    }

    function getShareText() {
        const totalAmount = document.getElementById('totalRewardDisplay').innerText;
        return `ğŸ’° ç‹‚ï¼æœ¬æœˆå›é¥‹ ${totalAmount}ï¼\nå¿«ä¾†è©¦ç®— ğŸ‘‰ https://shawn2026-oss.github.io/shawn-2026-creditcard/`;
    }

    // --- æ ¸å¿ƒè³‡æ–™åº«èˆ‡é‚è¼¯ ---

    fetch('config.json?t=' + Date.now()).then(response => response.json()).then(data => { if(data.news) document.getElementById('news-text').innerHTML = data.news; }).catch(error => {});
    let cardSettings = JSON.parse(localStorage.getItem('cardSettings')) || {};

    window.addEventListener('load', () => {
        injectHappyDetails(); 
        setTimeout(() => { const ticker = document.querySelector('.ticker-content'); if(ticker) { ticker.style.animation = 'none'; void ticker.offsetWidth; ticker.style.animation = 'scroll-left 15s linear infinite'; } }, 100);
        
        const isSetupDone = localStorage.getItem('user_setup_done');
        const hasLegacyData = localStorage.getItem('visibleCards') !== null;

        if (!isSetupDone) {
            if (hasLegacyData) {
                localStorage.setItem('user_setup_done', 'true');
                loadAndRenderApp();
            } else {
                initWelcomeModal();
            }
        } else {
            loadAndRenderApp();
        }
    });

    function initWelcomeModal() {
        const modal = document.getElementById('welcomeModal');
        const list = document.getElementById('welcomeList');
        list.innerHTML = '';
        cards.forEach(card => {
            if (card.id === 'add1') return;
            const item = document.createElement('div');
            item.className = 'welcome-item';
            item.innerHTML = `
                <input type="checkbox" id="w_${card.id}" value="${card.id}">
                <label for="w_${card.id}">${card.name}</label>
            `;
            list.appendChild(item);
        });
        modal.style.display = 'flex';
    }

    function saveWelcomeSettings() {
        const checkboxes = document.querySelectorAll('.welcome-item input[type="checkbox"]:checked');
        let selectedCards = [];
        checkboxes.forEach(cb => selectedCards.push(cb.value));
        if (selectedCards.length === 0) {
            alert("ğŸ’¡ å°æé†’ï¼š\nå»ºè­°å…ˆé¸å¹¾å¼µå¡ç‰‡è©¦ç”¨çœ‹çœ‹å–”ï¼");
            return;
        }
        localStorage.setItem('visibleCards', JSON.stringify(selectedCards));
        localStorage.setItem('user_setup_done', 'true');
        document.getElementById('welcomeModal').style.display = 'none';
        location.reload();
    }

    function loadAndRenderApp() {
        let currentCards = JSON.parse(localStorage.getItem('visibleCards')) || [];
        const realCardIds = cards.map(c => c.id).filter(id => id !== 'add1');
        let realCards = currentCards.filter(id => realCardIds.includes(id));
        if (realCards.length > 8) { 
            realCards = realCards.slice(0, 8);
            localStorage.setItem('visibleCards', JSON.stringify(realCards)); 
        }
        
        if (realCards.length < 8) { 
            if (!currentCards.includes('add1')) { 
                realCards.push('add1');
                localStorage.setItem('visibleCards', JSON.stringify(realCards)); 
            } 
        } else { 
            if (currentCards.includes('add1')) { 
                localStorage.setItem('visibleCards', JSON.stringify(realCards));
            } 
        }
        visibleCards = JSON.parse(localStorage.getItem('visibleCards'));
        renderGrid();
    }

    function closeModal() {
        document.getElementById('transactionModal').style.display = 'none';
        document.getElementById('manageModal').style.display = 'none';
        document.getElementById('sharePreviewModal').style.display = 'none';
    }

    window.addEventListener('popstate', function(event) { 
        closeModal();
    });

    const defaultCards = [
        { 
            id: 'c10', name: 'ä¸­ä¿¡ UniOpen å¡', nickname: '2026 çµ±ä¸€é›†åœ˜ç¥å¡', 
            note: 'icashPay +4% / æµ·å¤– 11% / è¸©é» +4%', 
            type: 'uniopen_special', gradient: 'linear-gradient(135deg, #FF512F 0%, #F09819 100%)', textColor: 'white', msgDanger: '', 
            parking: `ğŸª <b>çµ±ä¸€é›†åœ˜ 2026 æ–°æ¬Šç›Š</b><br>1. <b>åŸºæœ¬å›é¥‹</b>ï¼š1% (ç„¡ä¸Šé™)<br>2. <b>é›†åœ˜åŠ ç¢¼</b>ï¼š+2% (é™åˆ·$2.5è¬)<br>3. <b>è¸©é»ä»»å‹™</b>ï¼šæ»¿ 5 å®¶ +4% (é™åˆ·$1.25è¬)<br>4. <b>icash Pay</b>ï¼šåŠ ç¢¼ +4% (é™åˆ·$3,750)<br><br>âœˆï¸ <b>æµ·å¤–å¯¦é«”</b>ï¼š11% (3% + åŠ ç¢¼8%é™åˆ·$6,250)`
        },
        { 
            id: 'c6', name: 'å°æ–°è¡—å£è±¬å¯Œå¡', nickname: 'è¡Œæ”¯/ç¹³è²»ç¥å¡', 
            note: 'è¡Œæ”¯/æµ·å¤–/æ©Ÿç¥¨(é™åˆ·$8åƒ) | ç²¾é¸+2.5%(é™åˆ·40è¬)', 
            rule: '', type: 'ceiling', limit: 8000, tier1Rate: 0.135, tier2Rate: 0.035, 
            gradient: 'linear-gradient(135deg, #e60012 0%, #FFD700 100%)', 
            textColor: 'white', msgDanger: 'æ–°æˆ¶10%å·²å°é ‚',
            parking: `ğŸ· <b>æ–°æˆ¶é™å®šç¥å¡</b><br>æ–°æˆ¶ +10% (é™åˆ·$8,000)<br>ğŸŒŸ <b>ç²¾é¸é€šè·¯ +2.5%</b><br>ä¸Šé™ $40 è¬`
        },
        { id: 'c1', name: 'æ˜Ÿå±•å‚³èªªå°æ±ºå¡', nickname: 'Line Payç¥å¡', note: 'LinePay / è¦çš® / å¤–é€ (åˆ· $11,363 å°é ‚)', rule: '', type: 'ceiling', limit: 11363, tier1Rate: 0.10, tier2Rate: 0.012, gradient: 'linear-gradient(135deg, #43cea2 0%, #185a9d 100%)', textColor: 'white', msgDanger: 'å·²å°é ‚ (è®Š1.2%)' },
        { id: 'c5', name: 'è¯é‚¦è³´é»å¡', nickname: 'Line Payå„ªç­‰ç”Ÿ', note: 'Line Pay / å¶æ•¸æ—¥æŒ‡å®šé€šè·¯ (åˆ· $3,000 å°é ‚)', rule: 'âš ï¸ å–®ç­†éœ€æ»¿$100', type: 'ceiling', limit: 3000, tier1Rate: 0.06, tier2Rate: 0.01, threshold: 100, gradient: 'linear-gradient(135deg, #00B900 0%, #33CC33 100%)', textColor: 'white', msgDanger: 'å·²å°é ‚ (è®Š1%)', parking: `âš ï¸ <b>å–®ç­†éœ€æ»¿ $100</b> (å›é¥‹ 6%)`},
        { id: 'c3', name: 'æ°¸è± Sport å¡', nickname: 'Apple Payå„ªç­‰ç”Ÿ', note: 'Apple Pay 5% (åˆ· $5,000 å°é ‚)', rule: '', type: 'ceiling', limit: 5000, tier1Rate: 0.05, tier2Rate: 0.02, gradient: 'linear-gradient(135deg, #00B4DB 0%, #0083B0 100%)', textColor: 'white', msgDanger: 'å·²å°é ‚ (è®Š1%)' },
        { 
            id: 'c4', name: 'å°‡ä¾†å°‡å°‡å¡', nickname: 'è¡Œæ”¯/é¤å»³/å¤–é€', 
            note: 'ç”Ÿæ´»/æ—…éŠ 5% (éœ€æœˆåˆ·æ»¿ $3,000)', 
            rule: '', type: 'mixed', limit: 6666, minSpend: 3000, tier1Rate: 0.05, tier2Rate: 0.005, 
            gradient: 'linear-gradient(135deg, #ffe259 0%, #ffa751 100%)', textColor: '#333', msgDanger: 'å·²å°é ‚ (è®Š0.5%)', 
            parking: `ğŸ¯ <b>ä½æ¶ˆä»»å‹™</b>ï¼šç•¶æœˆç´¯ç©æ»¿ <b>$3,000</b> æ‰äº«åŠ ç¢¼<br><br>ğŸ›ï¸ <b>ç”Ÿæ´»å‡ç´š 5%</b> (é™åˆ·$6,666)<br>è¡Œå‹•æ”¯ä»˜/å¤–é€/é¤å»³/è³¼ç‰©<br><br>âœˆï¸ <b>æ—…éŠåŠ ç¢¼ 5%</b> (é™åˆ·$11,111)<br>æµ·å¤–/èˆªç©º/æ—…è¡Œç¤¾/é«˜éµ`
        },
        // è¯é‚¦ç¶ å¡ï¼šæ›´æ–° Limit ç‚º 3000
        { 
            id: 'c2', name: 'è¯é‚¦ç¶ å¡', nickname: 'ç¶ è‰²é€šè·¯ +5%', 
            note: 'åœ‹å…§1% / åœ‹å¤–2% / ç¶ è‰²6% (é™åˆ·$3000)', 
            rule: '', type: 'ceiling', limit: 3000, tier1Rate: 0.06, tier2Rate: 0.01, 
            gradient: 'linear-gradient(135deg, #20B2AA 0%, #008B8B 100%)', textColor: 'white', msgDanger: 'åŠ ç¢¼å·²å°é ‚ (è®Š1%)', 
            parking: `ğŸŒ¿ <b>ç¶ è‰²é€šè·¯</b><br>åŠ ç¢¼ 5% (ä¸Šé™150å…ƒ)<br>ç­‰æ–¼åˆ· 3,000 å…ƒå°é ‚`
        },
        { id: 'c7', name: 'ç‰å±± UNI å¡', nickname: 'è¡Œæ”¯/ç™¾è²¨å„ªç­‰ç”Ÿ', note: 'ä»»æ„3.5% / UP 4.5% (åˆ· 4~14è¬ å°é ‚)', type: 'ceiling', limit: 40000, tier1Rate: 0.035, tier2Rate: 0.01, gradient: 'linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%)', textColor: 'white', msgDanger: 'å·²å°é ‚ (è®Š1%)', 
          parking: `ğŸ”¥ <b>ä»»æ„é¸ 3.5%</b> (é™åˆ·$4è¬)<br>ğŸ†™ <b>UP é¸ 4.5%</b> (é™åˆ·$14è¬)<br>ğŸ¬ <b>çµ±ä¸€æ™‚ä»£ +3%</b> (é™åˆ·$1.6è¬)`},
        { 
            id: 'c8', name: 'é æ±æ¨‚å®¶+å¡', nickname: 'ç”Ÿæ´»/å¯µç‰©ç¥å¡', 
            note: 'å¯µç‰©10% | ç”Ÿæ´»/å®‰å¿ƒ 4% (éœ€ä¸€èˆ¬æ¶ˆè²»æ»¿3åƒ)', 
            type: 'ceiling', limit: 5263, tier1Rate: 0.1, tier2Rate: 0.005, 
            gradient: 'linear-gradient(135deg, #ff9a9e 0%, #fecfef 99%, #fecfef 100%)', 
            textColor: 'white', msgDanger: 'å·²å°é ‚ (è®Š0.5%)', 
            parking: `ğŸ¶ <b>å¯µç‰© 10%</b> (é™åˆ·$5,263)<br>ğŸ½ï¸ <b>å®‰å¿ƒ/ç”Ÿæ´» 4%</b> (é™åˆ·$5,714)<br>âœˆï¸ <b>åœ‹å¤– 2.5%</b> (ç„¡ä¸Šé™)`
        },
        { id: 'c9', name: 'æ»™è±æ—…äººå¡', nickname: 'å“©ç¨‹ç´¯ç©', note: 'ç„¡é™:åœ‹å…§18/åœ‹å¤–10 | å¾¡ç’½:åœ‹å…§18/åœ‹å¤–15', type: 'miles', gradient: 'linear-gradient(135deg, #1e3c72 0%, #2a5298 100%)', textColor: 'white', msgDanger: '', parking: `âœˆï¸ <b>å“©ç¨‹ç´¯ç©ç¥å¡</b>`},
        { id: 'c11', name: 'å°æ–° Richart å¡', nickname: 'æ¬Šç›Šè‡ªç”±é¸', note: 'å°æ–°Pay 3.8% / ç¶²è³¼ 3.3% / LP 2.3% (ç„¡ä¸Šé™)', type: 'ceiling', limit: 99999999, tier1Rate: 0.038, tier2Rate: 0.003, gradient: 'linear-gradient(135deg, #0F2027 0%, #203A43 50%, #2C5364 100%)', textColor: 'white', msgDanger: '', parking: `ğŸ¶ <b>æ¬Šç›Šè‡ªç”±é¸ (ç„¡ä¸Šé™å›é¥‹)</b>`},
        
        { 
            id: 'j1', name: 'å¯Œé‚¦ J å¡', nickname: 'æ—¥éŸ“æ—…éŠç¥å¡', 
            note: 'æ—¥éŸ“ 3% / å¯¦é«” +3% (åˆ· $33,333 å°é ‚)', 
            type: 'ceiling', limit: 33333, tier1Rate: 0.06, tier2Rate: 0.03, 
            gradient: 'linear-gradient(135deg, #FF7E5F 0%, #FEB47B 100%)', textColor: 'white', msgDanger: 'åŠ ç¢¼å·²å°é ‚ (è®Š3%)', 
            parking: `ğŸ‡¯ğŸ‡µ <b>æ—¥éŸ“å¯¦é«”æ¶ˆè²»</b><br>åŸºæœ¬ 3% + å¯¦é«” 3% = 6%<br>âš ï¸ å¯¦é«”åŠ ç¢¼ä¸Šé™ $1000/å­£ (ç´„åˆ·$3.3è¬)`
        },
        { 
            id: 'j2', name: 'è¯é‚¦å‰é¶´å¡', nickname: 'æ—¥æœ¬/ApplePayå°ˆæ­¦', 
            note: 'æ—¥æœ¬ 2.5% / Apple Pay +1.5% (åˆ· $40,000 å°é ‚)', 
            type: 'ceiling', limit: 40000, tier1Rate: 0.04, tier2Rate: 0.025, 
            gradient: 'linear-gradient(135deg, #DC143C 0%, #FFFFFF 150%)', textColor: 'white', msgDanger: 'åŠ ç¢¼å·²å°é ‚ (è®Š2.5%)', 
            parking: `ğŸ <b>æ—¥æœ¬ QUICPay (Apple Pay)</b><br>æ—¥æœ¬ 2.5% + åŠ ç¢¼ 1.5% = 4%<br>âš ï¸ åŠ ç¢¼ä¸Šé™ $600/æœˆ (ç´„åˆ·$4è¬)`
        },
        { 
            id: 'j3', name: 'ç‰å±±ç†Šæœ¬ç†Šå¡', nickname: 'è—¥å¦/Suica ç¥å¡', 
            note: 'æŒ‡å®šé€šè·¯ 8.5% (åˆ· $10,000 å°é ‚)', 
            type: 'ceiling', limit: 10000, tier1Rate: 0.085, tier2Rate: 0.025, 
            gradient: 'linear-gradient(135deg, #BDC3C7 0%, #2C3E50 100%)', textColor: 'white', msgDanger: 'åŠ ç¢¼å·²å°é ‚ (è®Š2.5%)', 
            parking: `ğŸ» <b>æŒ‡å®šé€šè·¯ 8.5%</b><br>(åŸºæœ¬1% + å…æ‰‹çºŒè²»1.5% + åŠ ç¢¼5% + é›™å¹£1%)<br>å« Suica åŠ å€¼ã€å”å‰è¨¶å¾·ã€å¤§åœ‹è—¥å¦ç­‰<br>âš ï¸ åŠ ç¢¼ä¸Šé™ $500/æœŸ (ç´„åˆ·$1è¬)`
        },
        { 
            id: 'j4', name: 'æ°¸è±å¹£å€å¡', nickname: 'æµ·å¤–é›™å¹£ç¥å¡', 
            note: 'ç²¾é¸/æµ·å¤– +4% (é™åˆ·$7,500 æˆ– $2è¬)', 
            type: 'ceiling', limit: 80000, tier1Rate: 0.06, tier2Rate: 0.02, 
            gradient: 'linear-gradient(135deg, #FDC830 0%, #F37335 100%)', textColor: 'white', msgDanger: 'åŠ ç¢¼å·²å°é ‚',
            parking: `ğŸ’° <b>å¹£å€å¡ 2026</b><br><b>Level 1 (é™åˆ·$7,500)</b>ï¼šè‡ªå‹•æ‰£ç¹³+é›»å­å¸³å–®<br><b>Level 2 (é™åˆ·$20,000)</b>ï¼šè³‡ç”¢â‰¥10è¬ æˆ– å¤§æˆ¶`
        },
        { 
            id: 'j5', name: 'æ°¸è±ä¸‰äº•è¯åå¡', nickname: 'é¤é£²/æ—¥éŸ“ç¥å¡', 
            note: 'é¤¨å¤–é¤é£²/å…¨ç›ˆ 7% (é™$100)', 
            type: 'floor', target: 30000, tier1Rate: 0.073, tier2Rate: 0.003, 
            gradient: 'linear-gradient(135deg, #00C9FF 0%, #92FE9D 100%)', textColor: '#333', msgSuccess: 'å·²é”æ¨™ (é ˜$2000)',
            parking: `ğŸ½ï¸ <b>ç‰¹é¸é€šè·¯ 7% (ä¸Šé™100å…ƒ)</b><br>é€šè·¯ï¼šé¤¨å¤–é¤é£²(MCC 58xx) / å…¨ç›ˆ+PAY<br>âš ï¸ åŠ ç¢¼ä¸Šé™åƒ… 100 å…ƒ (ç´„åˆ· $1,428)<br><br>ğŸ‡¯ğŸ‡µ <b>æ—¥éŸ“æ³°æ»¿é¡ç¦® (JCBé™å®š)</b><br>æ¯å­£ç´¯ç©æ»¿ 30,000 é€ 2,000`
        },

        { id: 'add1', name: 'æ–°å¢å¡ç‰‡', nickname: 'é»æ“Šé¸å¡', note: 'å‰å¾€è³‡æ–™åº«æŒ‘é¸', type: 'placeholder', gradient: 'linear-gradient(135deg, #e0e0e0 0%, #f5f5f5 100%)', textColor: '#999', msgDanger: '' }
    ];

    let visibleCards = JSON.parse(localStorage.getItem('visibleCards'));
    let savedOrder = JSON.parse(localStorage.getItem('cardOrder'));
    let cards = [...defaultCards];
    let sortableInstance = null;

    function getSortedCards() {
        if (!visibleCards) return [];
        let displayCards = cards.filter(c => visibleCards.includes(c.id));
        const realCardCount = displayCards.filter(c => c.type !== 'placeholder').length;
        if (realCardCount < 8 && !visibleCards.includes('add1')) { const placeholder = cards.find(c => c.id === 'add1');
        if(placeholder && !displayCards.includes(placeholder)) displayCards.push(placeholder); }
        if (savedOrder && Array.isArray(savedOrder)) { displayCards.sort((a, b) => { let indexA = savedOrder.indexOf(a.id); let indexB = savedOrder.indexOf(b.id); if (indexA === -1) indexA = 999; if (indexB === -1) indexB = 999; return indexA - indexB; });
        }
        return displayCards;
    }

    function initSortable() {
        var el = document.getElementById('card-grid');
        if (sortableInstance) { sortableInstance.destroy(); }
        sortableInstance = new Sortable(el, { animation: 150, ghostClass: 'sortable-ghost', dragClass: 'sortable-drag', delay: 200, delayOnTouchOnly: true, forceFallback: true, onEnd: function (evt) { const visibleOrder = Array.from(evt.to.children).map(el => el.getAttribute('data-card-id')); const allCardIds = cards.map(c => c.id); const hiddenCards = allCardIds.filter(id => !visibleOrder.includes(id)); const finalOrder = [...visibleOrder, ...hiddenCards]; localStorage.setItem('cardOrder', JSON.stringify(finalOrder)); savedOrder = finalOrder; } });
    }

    let transactions = JSON.parse(localStorage.getItem('transactions')) || [];
    function updateDate() { const now = new Date();
    document.getElementById('dateDisplay').innerText = `${now.getMonth()+1}/${now.getDate()}`; }
    function saveHsbcTier() { const tier = document.querySelector('input[name="hsbcTier"]:checked').value; localStorage.setItem('hsbc_tier', tier); renderGrid(); updateRewardPreview();
    }
    function saveHsbcInitial() { const initial = document.getElementById('hsbcInitialMiles').value; localStorage.setItem('hsbc_initial_miles', initial); renderGrid();
    }
    
    function saveHsbcSettings() {
        const redeemed = document.getElementById('hsbcRedeemedMiles').value;
        localStorage.setItem('hsbc_redeemed_miles', redeemed);
        renderGrid();
    }

    // --- å…¶é¤˜ JS é‚è¼¯ (saveUniOpenState, calculateStats ç­‰) å°‡åœ¨ç¬¬ä¸‰éƒ¨åˆ†å®Œæ•´å‘ˆç¾ ---
    // è«‹ç­‰å¾…ç¬¬ä¸‰éƒ¨åˆ† ...
</script>
</body>
</html>
